<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-wall.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-wall.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="baidu-site-verification" content="code-jsxllPgZAX">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.loli.net/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic|Ma Shan Zheng:300,300italic,400,400italic,700,700italic|JetBrains Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"thysrael.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":"flat"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="一、写在前面的话这篇博文的本质不是一篇答案的汇总，HDLBits的题目组织形式是蕴含思想的（就像五三或者衡中的数学卷子），可以看到，虽然大部分前面的题目都谈不上难，但是如果一道一道的做下来，就会有体会，网站的搭建者是希望通过这组题目，来传递一种硬件设计思想。当然，更谦虚的说法是硬件设计思想基础。这篇博文的目的就是通过这些题目，来勉力阐述这种思想。 我写到了FSM章节的一半，其他的都写了，短期内应该">
<meta property="og:type" content="article">
<meta property="og:title" content="计算机组成-HDLBits题解">
<meta property="og:url" content="https://thysrael.github.io/posts/fc8b68d4/index.html">
<meta property="og:site_name" content="钟鼓楼">
<meta property="og:description" content="一、写在前面的话这篇博文的本质不是一篇答案的汇总，HDLBits的题目组织形式是蕴含思想的（就像五三或者衡中的数学卷子），可以看到，虽然大部分前面的题目都谈不上难，但是如果一道一道的做下来，就会有体会，网站的搭建者是希望通过这组题目，来传递一种硬件设计思想。当然，更谦虚的说法是硬件设计思想基础。这篇博文的目的就是通过这些题目，来勉力阐述这种思想。 我写到了FSM章节的一半，其他的都写了，短期内应该">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://thysrael.github.io/posts/fc8b68d4/image-20211026205647699-16423204660301.png">
<meta property="og:image" content="https://thysrael.github.io/posts/fc8b68d4/image-20211026194446947-16423204939202.png">
<meta property="og:image" content="https://thysrael.github.io/posts/fc8b68d4/image-20211026194746201-16423204974793.png">
<meta property="og:image" content="https://thysrael.github.io/posts/fc8b68d4/image-20211026195222334-16423205016684.png">
<meta property="og:image" content="https://thysrael.github.io/posts/fc8b68d4/image-20211026195329255-16423205047345.png">
<meta property="article:published_time" content="2022-01-16T08:04:03.000Z">
<meta property="article:modified_time" content="2025-08-15T12:16:49.051Z">
<meta property="article:author" content="Thysrael">
<meta property="article:tag" content="知识总结">
<meta property="article:tag" content="S3课上">
<meta property="article:tag" content="计算机组成">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://thysrael.github.io/posts/fc8b68d4/image-20211026205647699-16423204660301.png">

<link rel="canonical" href="https://thysrael.github.io/posts/fc8b68d4/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>计算机组成-HDLBits题解 | 钟鼓楼</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>


<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="钟鼓楼" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>
      <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/thysrael" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">钟鼓楼</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">钟楼瘦，鼓楼胖</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">31</span></a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">70</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">199</span></a>

  </li>
        <li class="menu-item menu-item-resource">

    <a href="/resource/" rel="section"><i class="fa fa-book fa-fw"></i>Resource</a>

  </li>
        <li class="menu-item menu-item-links">

    <a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>Links</a>

  </li>
        <li class="menu-item menu-item-roam">

    <a href="/obsidian-quartz/" rel="section"><i class="fa fa-sitemap fa-fw"></i>Roam</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://thysrael.github.io/posts/fc8b68d4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar2.png">
      <meta itemprop="name" content="Thysrael">
      <meta itemprop="description" content="Can you hear me ?">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="钟鼓楼">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          计算机组成-HDLBits题解
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-01-16 16:04:03" itemprop="dateCreated datePublished" datetime="2022-01-16T16:04:03+08:00">2022-01-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-08-15 20:16:49" itemprop="dateModified" datetime="2025-08-15T20:16:49+08:00">2025-08-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90/" itemprop="url" rel="index"><span itemprop="name">计算机组成</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>39k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>36 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="一、写在前面的话"><a href="#一、写在前面的话" class="headerlink" title="一、写在前面的话"></a>一、写在前面的话</h2><p>这篇博文的本质不是一篇<strong>答案的汇总</strong>，HDLBits的题目组织形式是蕴含思想的（就像五三或者衡中的数学卷子），可以看到，虽然大部分前面的题目都谈不上难，但是如果一道一道的做下来，就会有体会，网站的搭建者是希望通过这组题目，来传递一种<strong>硬件设计思想</strong>。当然，更谦虚的说法是<strong>硬件设计思想基础</strong>。这篇博文的目的就是通过这些题目，来勉力阐述这种思想。</p>
<p>我写到了FSM章节的一半，其他的都写了，短期内应该是肝不动了，所以FSM的后面的答案就没有题解了，实在抱歉。</p>
<p>鸣谢名单在结尾放出。因为是无聊的刷题故事（不是为了写这篇文章，我打死都不会写这组题），所以鸣谢人员中只有很少在解决问题上为我提供帮助，但是倒是有很多人陪伴见证了这个无聊的故事，故一并鸣谢。</p>
<p>这篇文章还算成点的东西：</p>
<ul>
<li>层次命名：2.1</li>
<li>HDLBits与ISE在编译上的区别：3.1</li>
<li>硬件、画画和小姑娘：4.1.3</li>
<li>矢量的位选择规则：4.2.2,4.2.3</li>
<li>数据流级和行为级的区别：4.2.7</li>
<li>生成块语句：4.2.7</li>
<li>通用加法器的数学原理：4.3.9</li>
<li>两种always块语句与语言子集：4.4.1</li>
<li>锁存器除魅：4.4.4</li>
<li>casex，casez的优先编码特性：4.4.5</li>
<li>x和z的意义：4.4.5</li>
<li>应用整数描述行为，代替寄存器：4.5.4</li>
<li>变量初值问题：5.1.1.14</li>
<li>溢出判读方法在实现的局限性和数学证明：5.1.3.5</li>
<li>寄存器溢出问题：5.1.3.7</li>
<li>卡诺图：5.1.4.1</li>
<li>POS卡诺图：5.1.4.6</li>
<li>非阻塞赋值：5.2.1.14</li>
<li>检验边沿的各种标准写法：5.2.1.14</li>
<li>ISim模拟时间控制：5.2.2.8</li>
<li>大型for行为描述和位选实例：5.2.4.3</li>
<li>Testbench的书写：7.1</li>
</ul>
<hr>
<h2 id="二、无关题目"><a href="#二、无关题目" class="headerlink" title="二、无关题目"></a>二、无关题目</h2><h3 id="2-1-stop"><a href="#2-1-stop" class="headerlink" title="2.1 $stop"></a>2.1 $stop</h3><p>这个可以写在initial块里面，需要注意的是后面是需要<strong>加上分号</strong>的，要是丢了就会报错，所有的<strong>调用系统任务语句</strong>都需要加分号结尾。但是<strong>预编译处理指令</strong>是不需要加分号结尾的。</p>
<h3 id="2-2-层次命名"><a href="#2-2-层次命名" class="headerlink" title="2.2 层次命名"></a>2.2 层次命名</h3><ul>
<li><p>每一个<strong>模块实例</strong>，<strong>信号</strong>，<strong>变量</strong>，<strong>命名块</strong>，<strong>生成块</strong>都使用一个标识符进行定义</p>
</li>
<li><p>层次命名允许设计者在整个设计中通过唯一的名字表示每一个标识符</p>
</li>
<li><p>层次名由一连串使用 “<strong>.</strong>” 分隔的标识符组成，每个标识符代表一个层次。</p>
<p>这些知识我也是才接触不久，感觉还是很跟C有很大差别的，只是很难言明这种感觉，只能说很体现<strong>硬件</strong>思想，而并不是<strong>面向过程</strong>的软件语言（有点像面向对象），具体在实践的时候，我觉得有几个小体会</p>
<pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token punctuation">.</span><span class="token function">clk1</span><span class="token punctuation">(</span>clk2<span class="token punctuation">)</span><span class="token punctuation">,</span> <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>​    第一、我每次都分不清到底clk1和clk2哪个是端口，哪个是激励端，现在知道，加了” .  “的clk1是端口（因为是层次名），而clk2是激励端。</p>
<p>​    第二、对ISE左侧的继承关系更加清晰，</p>
<p><img src="/posts/fc8b68d4/image-20211026205647699-16423204660301.png" alt="image-20211026205647699"></p>
<p>​    可以看出，最上层的是<strong>测试平台</strong>，之后是top模块，之后是top模块实例化的各个小模块，即使测试平台并不是一个传统的模块（没法综合）但是它还是有一个名字。</p>
<p>​    第三、对命名块和生成块的理解加深</p>
<p>​    命名块应该是为了服务于内部的局部变量的，生成块应该是服务于在其中生成的硬件的，他们必选要名字，我会在下面的一组例题中阐述。</p>
</li>
</ul>
<hr>
<h2 id="三、Getting-Started"><a href="#三、Getting-Started" class="headerlink" title="三、Getting Started"></a>三、Getting Started</h2><h3 id="3-1-Getting-Started"><a href="#3-1-Getting-Started" class="headerlink" title="3.1 Getting Started"></a>3.1 Getting Started</h3><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span> <span class="token keyword">output</span> one <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Insert your code here</span>
    <span class="token keyword">assign</span> one <span class="token operator">=</span> <span class="token number">1'b1</span><span class="token punctuation">;</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>在首道题目中，需要强调的是HDLBit中的编译器特点，这个编译器不像ISE提供的编译器，最明显的差别就是在线编译器对<strong>线网类型和寄存器类型</strong>区分不明显，比如assign的左式也可以是reg，always左式是wire也可以，这些都是能编译通过并通过测评的，但是在ISE中是无法通过语法检测的，需要注意。</p>
<h3 id="3-2-Output-Zero"><a href="#3-2-Output-Zero" class="headerlink" title="3.2 Output Zero"></a>3.2 Output Zero</h3><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span>
    <span class="token keyword">output</span> zero
<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Module body starts after semicolon</span>
	<span class="token keyword">assign</span> zero <span class="token operator">=</span> <span class="token number">1'b0</span><span class="token punctuation">;</span>
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h2 id="四、Verilog-Language"><a href="#四、Verilog-Language" class="headerlink" title="四、Verilog Language"></a>四、Verilog Language</h2><h3 id="4-1-Basic"><a href="#4-1-Basic" class="headerlink" title="4.1 Basic"></a>4.1 Basic</h3><h4 id="4-1-1-Simple-Wire"><a href="#4-1-1-Simple-Wire" class="headerlink" title="4.1.1 Simple Wire"></a>4.1.1 Simple Wire</h4><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span> <span class="token keyword">input</span> in<span class="token punctuation">,</span> <span class="token keyword">output</span> out <span class="token punctuation">)</span><span class="token punctuation">;</span>
    
	<span class="token keyword">assign</span> out <span class="token operator">=</span> in<span class="token punctuation">;</span>
    
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这个题目用一个assign连续赋值语句来将输入和输出连接起来，标题的simple wire暗示了assign其实不是<strong>赋值</strong>，而是<strong>连接</strong>，我更加偏爱这种说法。</p>
<h4 id="4-1-2-Four-Wire"><a href="#4-1-2-Four-Wire" class="headerlink" title="4.1.2 Four Wire"></a>4.1.2 Four Wire</h4><p>最小白的写法是这样的</p>
<pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span> 
    <span class="token keyword">input</span> a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>
    <span class="token keyword">output</span> w<span class="token punctuation">,</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>z <span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">assign</span> w <span class="token operator">=</span> a<span class="token punctuation">;</span>
    <span class="token keyword">assign</span> x <span class="token operator">=</span> b<span class="token punctuation">;</span>
    <span class="token keyword">assign</span> y <span class="token operator">=</span> b<span class="token punctuation">;</span>
    <span class="token keyword">assign</span> z <span class="token operator">=</span> c<span class="token punctuation">;</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可以说还是很好的，是很硬件，一点也不过程的代码。然后看优化版</p>
<pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span> 
    <span class="token keyword">input</span> a<span class="token punctuation">,</span>
    <span class="token keyword">input</span> b<span class="token punctuation">,</span> 
    <span class="token keyword">input</span> c<span class="token punctuation">,</span>
    <span class="token keyword">output</span> w<span class="token punctuation">,</span>
    <span class="token keyword">output</span> x<span class="token punctuation">,</span>
    <span class="token keyword">output</span> y<span class="token punctuation">,</span>
    <span class="token keyword">output</span> z <span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">assign</span> <span class="token operator">{</span>w<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token operator">}</span> <span class="token operator">=</span> <span class="token operator">{</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token operator">}</span><span class="token punctuation">;</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这里做了两点优化，一个是端口的代码风格，改成了<strong>一个一行</strong>的形式，这种的好处是在避免<strong>一行过于长</strong>的情况，类似的方法还在parameter中出现。</p>
<p>另一个是利用拼接运算符简化assign语句的使用，这个在这道题目中有炫技的嫌疑，但是在移位寄存器等应用中，这种方法很体现本质。</p>
<h4 id="4-1-3-Inverter"><a href="#4-1-3-Inverter" class="headerlink" title="4.1.3 Inverter"></a>4.1.3 Inverter</h4><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span> <span class="token keyword">input</span> in<span class="token punctuation">,</span> <span class="token keyword">output</span> out <span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">assign</span> out <span class="token operator">=</span> <span class="token operator">~</span>in<span class="token punctuation">;</span>
	
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>在这里讲一下<strong>数据流级建模</strong>和<strong>行为级建模</strong>的区别，总的来说，这两种与其他方法的最重大区别就是不在有实例化（最具有硬件特征的代码）。对于两者的区别，<strong>数据流</strong>还是与硬件对应的很好的，他以assign和运算符为特征，只是为了简化一大堆<strong>逻辑门</strong>的实例化过程。<strong>行为级</strong>趋向于<strong>从模块外部</strong>描述模块的行为，以initial和always为标志，里面有<strong>循环</strong>和<strong>分支判断</strong>，这个级别与C语言更加接近（因为是在描述行为），与硬件的对应关系减弱（需要多思考才能意识到这其中的联系）。</p>
<p>我初学的时候，一直在想，verilog到底跟C有什么不同，现在越学越觉得，verilog与C有什么相同？他们两个好比<strong>姐妹种</strong>，只是外形相似，而内在完全不同。</p>
<p>而他们完全不同的原因，就是因为他们干的事情是不同的。对于<strong>面向过程</strong>的C，他描述的一种算法，是加工数据的一个过程，就好像一本小说，最重要的是<strong>在时间上流动的情节</strong>。对于<strong>硬件描述性语言</strong>的verilog，他描述的一块电路板，是元器件间的链接。就好像一幅画。确实一本小说里面可以有环境描写和人物介绍（变量声明），但是这些东西都是为了算法服务的。同样，作画的时候，我们说要画一个在草地上奔跑的姑娘，我们要画一百颗星星，我们要用白色和红色勾兑出粉色（分支判断，生成块），但是最后的成品依然是静态的一幅画。所有的代码都是为了描述一个硬件，这就是宗旨。</p>
<p>所以生成块如果用<strong>面向过程</strong>的角度来看，是不可理解的，<strong>生成代码</strong>对于C而言，就是<strong>生成算法</strong>，C可以接受循环，这代表着在时间上重复干一件事，但是绝对不能接受<strong>生成算法</strong>。但是对于verilog，<strong>循化</strong>才是不能接受的事情，画在纸上的姑娘可以哭，可以笑，但是由哭变笑，再重复100遍，是不可以的。但是我们可以接受纸上同时有100个或笑着或哭着的小姑娘。</p>
<p>我用logisim的时候，觉得这就是<strong>硬件描述软件</strong>，但是为什么在verilog中花了这么长时间才意识到这件事情。我觉得是因为verilog在<strong>简化</strong>描述的过程，在logisim的时候，我想要一个16个与门，我就得自己搭16次，连48次线，但是在verilog中，我可以用循环生成，在logisim我想实现一个有分支判断的电路，就要自己搭MUX，但是在这里，if-else就可以了。尽管画作是静态的，但是<strong>作画的过程</strong>是动态的，正是这里的动态让我产生了疑惑。此外，verilog不仅是为了描述硬件，他还描述<strong>测试平台</strong>，而测试平台显然是<strong>动态</strong>的，所以有些语句是为了测试平台写的，而不是为了描述硬件。</p>
<h4 id="4-1-4-AND-gate"><a href="#4-1-4-AND-gate" class="headerlink" title="4.1.4 AND gate"></a>4.1.4 AND gate</h4><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span> 
    <span class="token keyword">input</span> a<span class="token punctuation">,</span> 
    <span class="token keyword">input</span> b<span class="token punctuation">,</span> 
    <span class="token keyword">output</span> out <span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">assign</span> out <span class="token operator">=</span> a <span class="token operator">&amp;</span> b<span class="token punctuation">;</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>在后面这几道题目，都是<strong>数据流</strong>级的建模，做完就可以加深这种理解。</p>
<h4 id="4-1-5-NOR-gate"><a href="#4-1-5-NOR-gate" class="headerlink" title="4.1.5 NOR gate"></a>4.1.5 NOR gate</h4><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span> 
    <span class="token keyword">input</span> a<span class="token punctuation">,</span> 
    <span class="token keyword">input</span> b<span class="token punctuation">,</span> 
    <span class="token keyword">output</span> out <span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">assign</span> out <span class="token operator">=</span> <span class="token operator">~</span><span class="token punctuation">(</span>a <span class="token operator">|</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="4-1-6-XNOR-gate"><a href="#4-1-6-XNOR-gate" class="headerlink" title="4.1.6 XNOR gate"></a>4.1.6 XNOR gate</h4><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span> 
    <span class="token keyword">input</span> a<span class="token punctuation">,</span> 
    <span class="token keyword">input</span> b<span class="token punctuation">,</span> 
    <span class="token keyword">output</span> out <span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">assign</span> out <span class="token operator">=</span> <span class="token operator">~</span><span class="token punctuation">(</span>a <span class="token operator">^</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="4-1-7-Declaring-wires"><a href="#4-1-7-Declaring-wires" class="headerlink" title="4.1.7 Declaring wires"></a>4.1.7 Declaring wires</h4><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token constant">`default_nettype</span> none
<span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span>
    <span class="token keyword">input</span> a<span class="token punctuation">,</span>
    <span class="token keyword">input</span> b<span class="token punctuation">,</span>
    <span class="token keyword">input</span> c<span class="token punctuation">,</span>
    <span class="token keyword">input</span> d<span class="token punctuation">,</span>
    <span class="token keyword">output</span> out<span class="token punctuation">,</span>
    <span class="token keyword">output</span> out_n   <span class="token punctuation">)</span><span class="token punctuation">;</span> 
    
    <span class="token keyword">wire</span> e<span class="token punctuation">,</span> f<span class="token punctuation">;</span>
    
    <span class="token keyword">assign</span> e <span class="token operator">=</span> a <span class="token operator">&amp;</span> b<span class="token punctuation">;</span>
    <span class="token keyword">assign</span> f <span class="token operator">=</span> c <span class="token operator">&amp;</span> d<span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out <span class="token operator">=</span> e <span class="token operator">|</span> f<span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out_n <span class="token operator">=</span> <span class="token operator">~</span>out<span class="token punctuation">;</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>上面那个`default_nettype是将没有声明就使用的变量规定为不合法，要不然这样的变量在<strong>缺省</strong>的条件下是wire类型。</p>
<p>我们可以看到，尽管wire是“线”的意思，但是并没有起到<strong>连线</strong>的作用，起到连线作用的是<strong>赋值语句</strong>和<strong>模块实例化的端口连接</strong>，wire更像是一个<strong>节点</strong>。</p>
<h4 id="4-1-8-7458-chip"><a href="#4-1-8-7458-chip" class="headerlink" title="4.1.8 7458 chip"></a>4.1.8 7458 chip</h4><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span> 
    <span class="token keyword">input</span> p1a<span class="token punctuation">,</span> p1b<span class="token punctuation">,</span> p1c<span class="token punctuation">,</span> p1d<span class="token punctuation">,</span> p1e<span class="token punctuation">,</span> p1f<span class="token punctuation">,</span>
    <span class="token keyword">output</span> p1y<span class="token punctuation">,</span>
    <span class="token keyword">input</span> p2a<span class="token punctuation">,</span> p2b<span class="token punctuation">,</span> p2c<span class="token punctuation">,</span> p2d<span class="token punctuation">,</span>
    <span class="token keyword">output</span> p2y <span class="token punctuation">)</span><span class="token punctuation">;</span>
	
    <span class="token keyword">wire</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">;</span>
  
    <span class="token keyword">assign</span> a <span class="token operator">=</span> p1a <span class="token operator">&amp;</span> p1b <span class="token operator">&amp;</span> p1c<span class="token punctuation">;</span>
    <span class="token keyword">assign</span> b <span class="token operator">=</span> p1d <span class="token operator">&amp;</span> p1e <span class="token operator">&amp;</span> p1f<span class="token punctuation">;</span>
    <span class="token keyword">assign</span> c <span class="token operator">=</span> p2a <span class="token operator">&amp;</span> p2b<span class="token punctuation">;</span>
    <span class="token keyword">assign</span> d <span class="token operator">=</span> p2c <span class="token operator">&amp;</span> p2d<span class="token punctuation">;</span>
    <span class="token keyword">assign</span> p1y <span class="token operator">=</span> a <span class="token operator">|</span> b<span class="token punctuation">;</span>
    <span class="token keyword">assign</span> p2y <span class="token operator">=</span> c <span class="token operator">|</span> d<span class="token punctuation">;</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这个看图连接就可以，可以看到，声明中间变量可以简化assign语句。</p>
<h3 id="4-2-Vector"><a href="#4-2-Vector" class="headerlink" title="4.2 Vector"></a>4.2 Vector</h3><h4 id="4-2-1-Vectors"><a href="#4-2-1-Vectors" class="headerlink" title="4.2.1 Vectors"></a>4.2.1 Vectors</h4><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span> 
    <span class="token keyword">input</span> <span class="token keyword">wire</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> vec<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token keyword">wire</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> outv<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token keyword">wire</span> o2<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token keyword">wire</span> o1<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token keyword">wire</span> o0  <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Module body starts after module declaration</span>
    
    <span class="token keyword">assign</span> outv <span class="token operator">=</span> vec<span class="token punctuation">;</span>
    <span class="token keyword">assign</span> o0 <span class="token operator">=</span> vec<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> o1 <span class="token operator">=</span> vec<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> o2 <span class="token operator">=</span> vec<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可以看到<strong>向量</strong>这个词用得很好，它区别于数组的概念，它说的是一个线或者寄存器是<strong>多位宽</strong>的，而不是有一组线或者一组寄存器。</p>
<h4 id="4-2-2-Vectors-in-more-detail"><a href="#4-2-2-Vectors-in-more-detail" class="headerlink" title="4.2.2 Vectors in more detail"></a>4.2.2 Vectors in more detail</h4><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token constant">`default_nettype</span> none     <span class="token comment">// Disable implicit nets. Reduces some types of bugs.</span>
<span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span> 
    <span class="token keyword">input</span> <span class="token keyword">wire</span> <span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> in<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token keyword">wire</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> out_hi<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token keyword">wire</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> out_lo <span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">assign</span> out_hi <span class="token operator">=</span> in<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out_lo <span class="token operator">=</span> in<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这个题还是有很多语法细节需要强调的。</p>
<p>第一、对于向量来讲，重要的是<strong>高位</strong>和<strong>低位</strong>的概念，这规定了向量的方向，在verilog中，有</p>
<pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog">verctor <span class="token punctuation">[</span>msb_base_expr<span class="token punctuation">:</span>lsb_base_expr<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>左侧是最高位，右侧是最低位，高低不是看数字的大小</p>
<pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">wire</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">7</span><span class="token punctuation">]</span> a<span class="token punctuation">;</span>
<span class="token keyword">wire</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> b<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>a的最高位是a[0]，b的最高位是b[7]。</p>
<p>第二、向量声明的时候，写在“ [] ” 里的数字只是编号，而不具有<strong>计数意义</strong>，因为这样的写法都是允许的，比如</p>
<pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">]</span> x<span class="token punctuation">;</span>
<span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> y<span class="token punctuation">;</span>
<span class="token keyword">wire</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">7</span><span class="token punctuation">]</span> z<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>那么比如说我要调用x，y，z的最低位，不是x[0],y[0],z[0]（即不是最小的自然数0，这样就具有计数意义了）。而是x[1],y[-2],z[7]。这样只是编号。</p>
<h4 id="4-2-3-Vector-part-select"><a href="#4-2-3-Vector-part-select" class="headerlink" title="4.2.3 Vector part select"></a>4.2.3 Vector part select</h4><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span> 
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> in<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> out <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//</span>

    <span class="token keyword">assign</span> out<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> in<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">24</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">=</span> in<span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out<span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">]</span> <span class="token operator">=</span> in<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">24</span><span class="token punctuation">]</span> <span class="token operator">=</span> in<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这种写法可以过，但是介绍一种高端的位选方法，这种写法也可以过。</p>
<pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span> 
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> in<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> out <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//</span>

    <span class="token keyword">assign</span> out<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> in<span class="token punctuation">[</span><span class="token number">24</span><span class="token operator">+</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">=</span> in<span class="token punctuation">[</span><span class="token number">16</span><span class="token operator">+</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out<span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">]</span> <span class="token operator">=</span> in<span class="token punctuation">[</span><span class="token number">15</span><span class="token operator">-</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">24</span><span class="token punctuation">]</span> <span class="token operator">=</span> in<span class="token punctuation">[</span><span class="token number">7</span><span class="token operator">-</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>关于这种写法，有标准：</p>
<pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog">a<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">24</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
c<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

big_vect<span class="token punctuation">[</span>lsb_base_expr <span class="token operator">+</span><span class="token punctuation">:</span> width_expr<span class="token punctuation">]</span><span class="token punctuation">;</span>
big_vect<span class="token punctuation">[</span>msb_base_expr <span class="token operator">-</span><span class="token punctuation">:</span> width_expr<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//适用于a这样的向量</span>

little_vect<span class="token punctuation">[</span>msb_base_expr <span class="token operator">+</span><span class="token punctuation">:</span> width_expr<span class="token punctuation">]</span><span class="token punctuation">;</span>
little_vect<span class="token punctuation">[</span>lsb_base_expr <span class="token operator">-</span><span class="token punctuation">:</span> width_expr<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//适用于c这样的向量</span>

<span class="token comment">//a[0 +: 4] 就是 a[3:0]</span>
<span class="token comment">//a[7 -: 4] 就是 a[7:4]</span>
<span class="token comment">//c[0 +: 4] 就是 c[0:3]</span>
<span class="token comment">//c[7 -: 4] 就是 c[4:7]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>但是其实这种标注简单来说，就是<strong>忽略了方向</strong>，值关注<strong>编号区间</strong>的做法。</p>
<p>这种高端的位选有什么好处呢？是因为在普通的位选中，高位和低位都必须是常量，也就是说，没办法让类似循环一类的迭代变量参与位选。但是在这种方法中，位选基准位可以是变量，只要宽度是常量就可以了。在后面有题目举例。</p>
<h4 id="4-2-4-Bitwise-operators"><a href="#4-2-4-Bitwise-operators" class="headerlink" title="4.2.4 Bitwise operators"></a>4.2.4 Bitwise operators</h4><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span> 
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> a<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> b<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> out_or_bitwise<span class="token punctuation">,</span>
    <span class="token keyword">output</span> out_or_logical<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> out_not
<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out_or_bitwise <span class="token operator">=</span> a <span class="token operator">|</span> b<span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out_or_logical <span class="token operator">=</span> a <span class="token operator">||</span> b<span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out_not <span class="token operator">=</span> <span class="token operator">{~</span>b<span class="token punctuation">,</span> <span class="token operator">~</span>a<span class="token operator">}</span><span class="token punctuation">;</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这道题主要是区分<strong>位运算</strong>和<strong>逻辑运算</strong>的，向量位运算的结果还是一个向量，逻辑运算的结果，其实是把向量转化成一个整数，在转化成一个bool值（非0为1，0为0），再得出一个bool值的结果。</p>
<p>关于位运算的优先级，除了<strong>移位运算符</strong>，其他运算符的优先级都是要比“ == ”的运算级要低，所以使用位运算，最好<strong>加括号</strong>。</p>
<h4 id="4-2-5-Four-input-gates"><a href="#4-2-5-Four-input-gates" class="headerlink" title="4.2.5 Four-input gates"></a>4.2.5 Four-input gates</h4><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span> 
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> in<span class="token punctuation">,</span>
    <span class="token keyword">output</span> out_and<span class="token punctuation">,</span>
    <span class="token keyword">output</span> out_or<span class="token punctuation">,</span>
    <span class="token keyword">output</span> out_xor
<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out_and <span class="token operator">=</span> <span class="token operator">&amp;</span>in<span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out_or <span class="token operator">=</span> <span class="token operator">|</span>in<span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out_xor <span class="token operator">=</span> <span class="token operator">^</span>in<span class="token punctuation">;</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这个题目其实是<strong>缩减运算符</strong>的应用，作为一个单目运算符，可以将向量的每一位作为运算对象进行运算。</p>
<h4 id="4-2-6-Vector-concatenation-operator"><a href="#4-2-6-Vector-concatenation-operator" class="headerlink" title="4.2.6 Vector concatenation operator"></a>4.2.6 Vector concatenation operator</h4><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> e<span class="token punctuation">,</span> f<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> w<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//</span>

    <span class="token keyword">assign</span> <span class="token operator">{</span>w<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token operator">}</span> <span class="token operator">=</span> <span class="token operator">{</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> e<span class="token punctuation">,</span> f<span class="token punctuation">,</span> <span class="token number">2'b11</span><span class="token operator">}</span><span class="token punctuation">;</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这是在引入<strong>位拼接运算符</strong>。    </p>
<h4 id="4-2-7-Vector-reversal-1"><a href="#4-2-7-Vector-reversal-1" class="headerlink" title="4.2.7 Vector reversal 1"></a>4.2.7 Vector reversal 1</h4><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span> 
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> in<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> out
<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out <span class="token operator">=</span> <span class="token operator">{</span>in<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> in<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> in<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> in<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> in<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> in<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> in<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> in<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token operator">}</span><span class="token punctuation">;</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这种方法还是十分笨拙的，但是其实是最好理解的，对于更加复杂的行为，我们可能需要更多的知识才能理解，所以后面还会有后续题目。</p>
<p>但是鉴于理解的连贯性，所以在这里一并书写，如果难以理解，不妨到了后面再看。</p>
<p>有一种用for循环的写法</p>
<pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span> 
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> in<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> out
<span class="token punctuation">)</span><span class="token punctuation">;</span>
   	<span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>	
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>	<span class="token comment">// int is a SystemVerilog type. Use integer for pure Verilog.</span>
			out<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> in<span class="token punctuation">[</span><span class="token number">8</span><span class="token operator">-</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">end</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>需要注意，这是一种<strong>行为描述</strong>，而不是一个<strong>过程描述</strong>，这个不是一个<strong>循环赋值的过程</strong>，而是<strong>描述了一种执行循环赋值的功能模块</strong>。这是一个很好的<strong>行为级描述</strong>的例子。</p>
<p>还需要注意的是只有i = i + 1;，没有i++;</p>
<p>还有一种是运用循环生成语句</p>
<pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span> 
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> in<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> out
<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">generate</span>
		<span class="token keyword">genvar</span> i<span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span> i <span class="token operator">=</span> i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">begin</span><span class="token punctuation">:</span> my_block_name
			<span class="token keyword">assign</span> out<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> in<span class="token punctuation">[</span><span class="token number">8</span><span class="token operator">-</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token keyword">end</span>
	<span class="token keyword">endgenerate</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这就是<strong>循环生成</strong>语句，这是一种<strong>数据流级别</strong>的描述，是区别于<strong>行为描述</strong>的（两者的概念区别可以在4.1.3中有介绍）。可以看出，行为描述了<strong>1个</strong>具有这样行为的模块，而循环生成语句其实连接了<strong>8个</strong>模块，这是区别。</p>
<p>为什么循环生成语句中的for一定需要一个<strong>名字</strong>，这是与<strong>层次命名</strong>有关的。如果循环生成语句里面是结构建模，我们为了指定哪个非门，就需要层次的帮助，那么就是块语句需要名字的原因。可以好好体会。</p>
<h4 id="4-2-8-Replication-operator"><a href="#4-2-8-Replication-operator" class="headerlink" title="4.2.8 Replication operator"></a>4.2.8 Replication operator</h4><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> in<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> out <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//</span>

    <span class="token keyword">assign</span> out <span class="token operator">=</span> <span class="token operator">{{</span><span class="token number">24</span><span class="token operator">{</span>in<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token operator">}}</span><span class="token punctuation">,</span> in<span class="token operator">}</span><span class="token punctuation">;</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这个需要强调的是，应用<strong>重复法</strong>的时候，需要在重复单元以后再加一个位拼接运算符，即，这种是错误的</p>
<pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token operator">{</span>a<span class="token punctuation">,</span> <span class="token number">4</span><span class="token operator">{</span>b<span class="token operator">}}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>而正确的写法是</p>
<pre class="line-numbers language-none"><code class="language-none">{a, {4{b}}}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="4-2-9-More-replication"><a href="#4-2-9-More-replication" class="headerlink" title="4.2.9 More replication"></a>4.2.9 More replication</h4><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">input</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> e<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> out <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">assign</span> out <span class="token operator">=</span> <span class="token operator">~</span><span class="token punctuation">(</span><span class="token operator">{{</span><span class="token number">5</span><span class="token operator">{</span>a<span class="token operator">}}</span><span class="token punctuation">,</span> <span class="token operator">{</span><span class="token number">5</span><span class="token operator">{</span>b<span class="token operator">}}</span><span class="token punctuation">,</span> <span class="token operator">{</span><span class="token number">5</span><span class="token operator">{</span>c<span class="token operator">}}</span><span class="token punctuation">,</span> <span class="token operator">{</span><span class="token number">5</span><span class="token operator">{</span>d<span class="token operator">}}</span><span class="token punctuation">,</span> <span class="token operator">{</span><span class="token number">5</span><span class="token operator">{</span>e<span class="token operator">}}}</span> <span class="token operator">^</span> <span class="token operator">{{</span><span class="token number">5</span><span class="token operator">{</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> e<span class="token operator">}}}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这是上一道题目的巩固。</p>
<h3 id="4-3-Modules：Hierarchy"><a href="#4-3-Modules：Hierarchy" class="headerlink" title="4.3 Modules：Hierarchy"></a>4.3 Modules：Hierarchy</h3><h4 id="4-3-1-Modules"><a href="#4-3-1-Modules" class="headerlink" title="4.3.1 Modules"></a>4.3.1 Modules</h4><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span> <span class="token keyword">input</span> a<span class="token punctuation">,</span> <span class="token keyword">input</span> b<span class="token punctuation">,</span> <span class="token keyword">output</span> out <span class="token punctuation">)</span><span class="token punctuation">;</span>

    mod_a <span class="token function">instance1</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>从这一章开始会涉及很多<strong>模块实例化</strong>的内容，个人认为其实这个部分才是电子设计的精髓，不只是把不同功能的东西拼在一起，而是把<strong>功能较为弱，规模较为小</strong>的模块（比如只能计算一位）<strong>聚合成功能强大，规模较为大</strong>的模块。</p>
<h4 id="4-3-2-Connecting-ports-by-position"><a href="#4-3-2-Connecting-ports-by-position" class="headerlink" title="4.3.2 Connecting ports by position"></a>4.3.2 Connecting ports by position</h4><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span> 
    <span class="token keyword">input</span> a<span class="token punctuation">,</span> 
    <span class="token keyword">input</span> b<span class="token punctuation">,</span> 
    <span class="token keyword">input</span> c<span class="token punctuation">,</span>
    <span class="token keyword">input</span> d<span class="token punctuation">,</span>
    <span class="token keyword">output</span> out1<span class="token punctuation">,</span>
    <span class="token keyword">output</span> out2
<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mod_a <span class="token function">ins</span><span class="token punctuation">(</span>out1<span class="token punctuation">,</span> out2<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>需要注意的是，out1，out2这样连接在模块端口的输出变量，只能是wire类型的，用reg类型会在ISim上会输出x，但是这个问题不会在HDLBits上暴露，因为它格式不严格。</p>
<h4 id="4-3-3-Connecting-ports-by-name"><a href="#4-3-3-Connecting-ports-by-name" class="headerlink" title="4.3.3 Connecting ports by name"></a>4.3.3 Connecting ports by name</h4><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span> 
    <span class="token keyword">input</span> a<span class="token punctuation">,</span> 
    <span class="token keyword">input</span> b<span class="token punctuation">,</span> 
    <span class="token keyword">input</span> c<span class="token punctuation">,</span>
    <span class="token keyword">input</span> d<span class="token punctuation">,</span>
    <span class="token keyword">output</span> out1<span class="token punctuation">,</span>
    <span class="token keyword">output</span> out2
<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    mod_a <span class="token function">ins</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">out1</span><span class="token punctuation">(</span>out1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">out2</span><span class="token punctuation">(</span>out2<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">in1</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">in2</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">in3</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">in4</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>还是可以看出<strong>层次命名</strong>的应用，通过<strong>“ . ”</strong>来调用端口名。</p>
<h4 id="4-3-4-Three-modules"><a href="#4-3-4-Three-modules" class="headerlink" title="4.3.4 Three modules"></a>4.3.4 Three modules</h4><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span> <span class="token keyword">input</span> clk<span class="token punctuation">,</span> <span class="token keyword">input</span> d<span class="token punctuation">,</span> <span class="token keyword">output</span> q <span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">wire</span> q1<span class="token punctuation">,</span> q2<span class="token punctuation">;</span>
    
    my_dff <span class="token function">D1</span><span class="token punctuation">(</span>clk<span class="token punctuation">,</span> d<span class="token punctuation">,</span> q1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    my_dff <span class="token function">D2</span><span class="token punctuation">(</span>clk<span class="token punctuation">,</span> q1<span class="token punctuation">,</span> q2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    my_dff <span class="token function">D3</span><span class="token punctuation">(</span>clk<span class="token punctuation">,</span> q2<span class="token punctuation">,</span> q<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="4-3-5-Modules-and-vectors"><a href="#4-3-5-Modules-and-vectors" class="headerlink" title="4.3.5 Modules and vectors"></a>4.3.5 Modules and vectors</h4><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span> 
    <span class="token keyword">input</span> clk<span class="token punctuation">,</span> 
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> d<span class="token punctuation">,</span> 
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> sel<span class="token punctuation">,</span> 
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> q 
<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">wire</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> q1<span class="token punctuation">,</span> q2<span class="token punctuation">,</span> q3<span class="token punctuation">;</span>

    my_dff8 <span class="token function">D1</span><span class="token punctuation">(</span>clk<span class="token punctuation">,</span> d<span class="token punctuation">,</span> q1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">D2</span><span class="token punctuation">(</span>clk<span class="token punctuation">,</span> q1<span class="token punctuation">,</span> q2<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">D3</span><span class="token punctuation">(</span>clk<span class="token punctuation">,</span> q2<span class="token punctuation">,</span> q3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>
        <span class="token function">case</span><span class="token punctuation">(</span>sel<span class="token punctuation">)</span>
            <span class="token number">2'h0</span><span class="token punctuation">:</span>
                q <span class="token operator">&lt;=</span> d<span class="token punctuation">;</span>
            <span class="token number">2'h1</span><span class="token punctuation">:</span>
                q <span class="token operator">&lt;=</span> q1<span class="token punctuation">;</span>
            <span class="token number">2'h2</span><span class="token punctuation">:</span>
                q <span class="token operator">&lt;=</span> q2<span class="token punctuation">;</span>
            <span class="token number">2'h3</span><span class="token punctuation">:</span>
                q <span class="token operator">&lt;=</span> q3<span class="token punctuation">;</span>
        <span class="token keyword">endcase</span>
    <span class="token keyword">end</span>    
    
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="4-3-6-Adder1"><a href="#4-3-6-Adder1" class="headerlink" title="4.3.6 Adder1"></a>4.3.6 Adder1</h4><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> a<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> b<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> sum
<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">wire</span> carry1<span class="token punctuation">,</span> carry2<span class="token punctuation">;</span>
    add16 <span class="token function">low</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> b<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1'b0</span><span class="token punctuation">,</span> sum<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> carry1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    add16 <span class="token function">high</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">,</span> b<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">,</span> carry1<span class="token punctuation">,</span> sum<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">,</span> carry2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>加法器就是很明显的那种功能较弱的模块聚合成功能较强的模块的例子，以后设计的时候也可以从这个角度思考，先解决一个小问题，在通过增设端口来解决大问题，可以说是一种<strong>自底向上</strong>了。</p>
<h4 id="4-3-7-Adder2"><a href="#4-3-7-Adder2" class="headerlink" title="4.3.7 Adder2"></a>4.3.7 Adder2</h4><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> a<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> b<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> sum
<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//</span>
	<span class="token keyword">wire</span> carry1<span class="token punctuation">,</span> carry2<span class="token punctuation">;</span>
    add16 <span class="token function">low</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> b<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1'b0</span><span class="token punctuation">,</span> sum<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> carry1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    add16 <span class="token function">high</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">,</span> b<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">,</span> carry1<span class="token punctuation">,</span> sum<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">,</span> carry2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token keyword">endmodule</span>

<span class="token keyword">module</span> add1 <span class="token punctuation">(</span> <span class="token keyword">input</span> a<span class="token punctuation">,</span> <span class="token keyword">input</span> b<span class="token punctuation">,</span> <span class="token keyword">input</span> cin<span class="token punctuation">,</span>   <span class="token keyword">output</span> sum<span class="token punctuation">,</span> <span class="token keyword">output</span> cout <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">assign</span> <span class="token operator">{</span>cout<span class="token punctuation">,</span> sum<span class="token operator">}</span> <span class="token operator">=</span> a <span class="token operator">+</span> b <span class="token operator">+</span> cin<span class="token punctuation">;</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这道题题面还是很难读懂的，其实add16他写好了一部分，其中用到的add1需要读者自己写。</p>
<h4 id="4-3-8-Carry-select-adder"><a href="#4-3-8-Carry-select-adder" class="headerlink" title="4.3.8 Carry-select adder"></a>4.3.8 Carry-select adder</h4><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> a<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> b<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> sum
<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">wire</span> cout<span class="token punctuation">,</span> c1<span class="token punctuation">;</span>
    <span class="token keyword">wire</span> <span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> sum1<span class="token punctuation">,</span> sum2<span class="token punctuation">;</span>
    
    add16 <span class="token function">low</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> b<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1'b0</span><span class="token punctuation">,</span> sum<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cout<span class="token punctuation">)</span><span class="token punctuation">;</span>
    add16 <span class="token function">high0</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">a</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">b</span><span class="token punctuation">(</span>b<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">cin</span><span class="token punctuation">(</span><span class="token number">1'b0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span>sum1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    add16 <span class="token function">high1</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">a</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">b</span><span class="token punctuation">(</span>b<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">cin</span><span class="token punctuation">(</span><span class="token number">1'b1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span>sum2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>
        <span class="token function">if</span><span class="token punctuation">(</span>cout <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
            sum<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> sum1<span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            sum<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> sum2<span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这也是一种改进<strong>串行加法器</strong>的方法，只不过实现起来看着不如<strong>超前进位加法器</strong>优雅。</p>
<h4 id="4-3-9-Adder-subtractor"><a href="#4-3-9-Adder-subtractor" class="headerlink" title="4.3.9 Adder-subtractor"></a>4.3.9 Adder-subtractor</h4><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> a<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> b<span class="token punctuation">,</span>
    <span class="token keyword">input</span> sub<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> sum
<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">wire</span> <span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> tmp<span class="token punctuation">;</span>
    <span class="token keyword">wire</span> cout<span class="token punctuation">;</span>
    
    <span class="token keyword">assign</span> tmp <span class="token operator">=</span> b <span class="token operator">^</span> <span class="token operator">{</span><span class="token number">32</span><span class="token operator">{</span>sub<span class="token operator">}}</span><span class="token punctuation">;</span>
    
    add16 <span class="token function">low</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> tmp<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> sub<span class="token punctuation">,</span> sum<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cout<span class="token punctuation">)</span><span class="token punctuation">;</span>
    add16 <span class="token function">high</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">,</span> tmp<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cout<span class="token punctuation">,</span> sum<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这个设计实在是太漂亮了，利用<strong>补码的补码是原码</strong>，<strong>取反加一是补码</strong>的原理，结合<strong>异或取反</strong>和<strong>进位加一</strong>，实现了加法器和减法器的统一，这个的具体原理在<a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/living_frontier/article/details/120583473">硬件中的数_living_frontier的博客-CSDN博客</a>有，在这里就不讲了。</p>
<h3 id="4-4-Procedures"><a href="#4-4-Procedures" class="headerlink" title="4.4 Procedures"></a>4.4 Procedures</h3><h4 id="4-4-1-Always-blocks（combinational）"><a href="#4-4-1-Always-blocks（combinational）" class="headerlink" title="4.4.1 Always blocks（combinational）"></a>4.4.1 Always blocks（combinational）</h4><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span>
    <span class="token keyword">input</span> a<span class="token punctuation">,</span> 
    <span class="token keyword">input</span> b<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token keyword">wire</span> out_assign<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token keyword">reg</span> out_alwaysblock
<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">assign</span> out_assign <span class="token operator">=</span> a <span class="token operator">&amp;</span> b<span class="token punctuation">;</span>
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> out_alwaysblock <span class="token operator">=</span> a <span class="token operator">&amp;</span> b<span class="token punctuation">;</span>
    
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这章叫做procedure，主要的就是<strong>行为级建模</strong>的诸多例子，其中有<strong>数据流级</strong>有很大差别，语法更加接近C，需要好好体会。</p>
<p>HDLBits在很明确的把always模块分为了两类，一种是<strong>组合逻辑</strong>，一种是<strong>时序逻辑</strong>。这是一种很好的<strong>角度</strong>，要是不刷题，估计意识到这件事情要很久。</p>
<h4 id="4-4-2-Always-blocks（clocked）"><a href="#4-4-2-Always-blocks（clocked）" class="headerlink" title="4.4.2 Always blocks（clocked）"></a>4.4.2 Always blocks（clocked）</h4><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span>
    <span class="token keyword">input</span> clk<span class="token punctuation">,</span>
    <span class="token keyword">input</span> a<span class="token punctuation">,</span>
    <span class="token keyword">input</span> b<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token keyword">wire</span> out_assign<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token keyword">reg</span> out_always_comb<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token keyword">reg</span> out_always_ff   <span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">assign</span> out_assign <span class="token operator">=</span> a <span class="token operator">^</span> b<span class="token punctuation">;</span>
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> out_always_comb <span class="token operator">=</span> a <span class="token operator">^</span> b<span class="token punctuation">;</span>
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> out_always_ff <span class="token operator">=</span> a <span class="token operator">^</span> b<span class="token punctuation">;</span>
        
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>有一个问题我一直想论证，就是学习一门语言，不需要学习他的全部，而是学习他的<strong>子集</strong>。只要这些<strong>子集</strong>可以<strong>张成全部描述功能</strong>就好了，比如其实Always块的语法还有很多，但是了解了上面这两种，就可以解决大部分问题了。类似的例子还出现在<strong>可综合的语法的模块书写</strong>和<strong>不可综合的testbench</strong>上。</p>
<h4 id="4-4-3-If-statement"><a href="#4-4-3-If-statement" class="headerlink" title="4.4.3 If statement"></a>4.4.3 If statement</h4><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span>
    <span class="token keyword">input</span> a<span class="token punctuation">,</span>
    <span class="token keyword">input</span> b<span class="token punctuation">,</span>
    <span class="token keyword">input</span> sel_b1<span class="token punctuation">,</span>
    <span class="token keyword">input</span> sel_b2<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token keyword">wire</span> out_assign<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token keyword">reg</span> out_always   <span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">assign</span> out_assign <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">{</span>sel_b1<span class="token punctuation">,</span> sel_b2<span class="token operator">}</span> <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">?</span> b <span class="token punctuation">:</span> a<span class="token punctuation">;</span>
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>
        <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">{</span>sel_b1<span class="token punctuation">,</span> sel_b2<span class="token operator">}</span> <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span>
            out_always <span class="token operator">=</span> b<span class="token punctuation">;</span>
    	<span class="token keyword">else</span>
            out_always <span class="token operator">=</span> a<span class="token punctuation">;</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="4-4-4-If-statement-latches"><a href="#4-4-4-If-statement-latches" class="headerlink" title="4.4.4 If statement latches"></a>4.4.4 If statement latches</h4><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">input</span>      cpu_overheated<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token keyword">reg</span> shut_off_computer<span class="token punctuation">,</span>
    <span class="token keyword">input</span>      arrived<span class="token punctuation">,</span>
    <span class="token keyword">input</span>      gas_tank_empty<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token keyword">reg</span> keep_driving  <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//</span>

    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>cpu_overheated<span class="token punctuation">)</span>
           shut_off_computer <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span>

    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">~</span>arrived<span class="token punctuation">)</span>
           keep_driving <span class="token operator">=</span> <span class="token operator">~</span>gas_tank_empty<span class="token punctuation">;</span>
    <span class="token keyword">end</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这里讲一下<strong>锁存器</strong>问题，如果没有else，default，这类东西都会造成<strong>锁存器</strong>。所谓<strong>锁存器</strong>就是<strong>电平敏感</strong>的存储电路。其实在实际的电子设计中还算常见。</p>
<p>但是我初学的时候，似乎<strong>锁存器</strong>是一个令人谈虎色变的东西，但具体询问为什么不好？得出的结论就是<strong>容易造成bug</strong>，但是为什么一个正常的东西，会造成bug，能解释的人就少了。</p>
<p>经过多方的协助，我个人感觉有两点原因：第一个是在综合的时候，受限于FGPA设计，锁存器的实现需要大量的硬件资源，所以不值当的。第二个是真的容易出bug，是因为我们进行电路设计的时候，都是把电路拆分成<strong>组合逻辑</strong>和<strong>寄存器</strong>两个部分，那么锁存器，不是组合逻辑，不是寄存器，但是它伪装的很像<strong>组合逻辑</strong>，这样就很难debug了，也就是说，是因为我们的设计习惯这个<strong>主观因素</strong>导致了锁存器的尴尬。</p>
<p>类比一下，锁存器就像C语言的<strong>go</strong>一样，功能是没有毛病（不是像网上说的会<strong>导致毛刺</strong>之类的，那些原因也会使寄存器毛刺），但是跟我们的设计习惯不符。</p>
<h4 id="4-4-5-Case-statement"><a href="#4-4-5-Case-statement" class="headerlink" title="4.4.5 Case statement"></a>4.4.5 Case statement</h4><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span> 
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> sel<span class="token punctuation">,</span> 
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> data0<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> data1<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> data2<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> data3<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> data4<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> data5<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> out   <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//</span>

    <span class="token important">always@</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>  <span class="token comment">// This is a combinational circuit</span>
        <span class="token function">case</span><span class="token punctuation">(</span>sel<span class="token punctuation">)</span>
            <span class="token number">0</span><span class="token punctuation">:</span>
                out <span class="token operator">=</span> data0<span class="token punctuation">;</span>
            <span class="token number">1</span><span class="token punctuation">:</span>
                out <span class="token operator">=</span> data1<span class="token punctuation">;</span>
            <span class="token number">2</span><span class="token punctuation">:</span>
                out <span class="token operator">=</span> data2<span class="token punctuation">;</span>
            <span class="token number">3</span><span class="token punctuation">:</span>
                out <span class="token operator">=</span> data3<span class="token punctuation">;</span>
            <span class="token number">4</span><span class="token punctuation">:</span>
                out <span class="token operator">=</span> data4<span class="token punctuation">;</span>
            <span class="token number">5</span><span class="token punctuation">:</span>
                out <span class="token operator">=</span> data5<span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token punctuation">:</span>
                out <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">endcase</span>
    <span class="token keyword">end</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="4-4-6-Priority-encoder"><a href="#4-4-6-Priority-encoder" class="headerlink" title="4.4.6 Priority encoder"></a>4.4.6 Priority encoder</h4><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> in<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> pos  <span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>
        <span class="token function">case</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span>
            <span class="token number">4'b0000</span><span class="token punctuation">:</span> pos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token number">4'b0001</span><span class="token punctuation">:</span> pos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token number">4'b0010</span><span class="token punctuation">:</span> pos <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token number">4'b0011</span><span class="token punctuation">:</span> pos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token number">4'b0100</span><span class="token punctuation">:</span> pos <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
            <span class="token number">4'b0101</span><span class="token punctuation">:</span> pos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token number">4'b0110</span><span class="token punctuation">:</span> pos <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token number">4'b0111</span><span class="token punctuation">:</span> pos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token number">4'b1000</span><span class="token punctuation">:</span> pos <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
            <span class="token number">4'b1001</span><span class="token punctuation">:</span> pos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token number">4'b1010</span><span class="token punctuation">:</span> pos <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token number">4'b1011</span><span class="token punctuation">:</span> pos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token number">4'b1100</span><span class="token punctuation">:</span> pos <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
            <span class="token number">4'b1101</span><span class="token punctuation">:</span> pos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token number">4'b1110</span><span class="token punctuation">:</span> pos <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token number">4'b1111</span><span class="token punctuation">:</span> pos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">endcase</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这里介绍case的两个重要特性，一个是多种输出相同的情况是可以用“ ，”并列排布的，比如这样也是可以通过的:</p>
<pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> in<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> pos  <span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>
        <span class="token function">case</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span>
            <span class="token number">4'b0000</span><span class="token punctuation">,</span> 
            <span class="token number">4'b0001</span><span class="token punctuation">,</span> 
            <span class="token number">4'b0011</span><span class="token punctuation">,</span> 
            <span class="token number">4'b0101</span><span class="token punctuation">,</span> 
            <span class="token number">4'b0111</span><span class="token punctuation">,</span> 
            <span class="token number">4'b1001</span><span class="token punctuation">,</span> 
            <span class="token number">4'b1011</span><span class="token punctuation">,</span> 
            <span class="token number">4'b1101</span><span class="token punctuation">,</span> 
            <span class="token number">4'b1111</span><span class="token punctuation">:</span> 
                pos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token number">4'b0010</span><span class="token punctuation">,</span> 
            <span class="token number">4'b0110</span><span class="token punctuation">,</span> 
            <span class="token number">4'b1010</span><span class="token punctuation">,</span> 
            <span class="token number">4'b1110</span><span class="token punctuation">:</span> 
                pos <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token number">4'b0100</span><span class="token punctuation">,</span> 
            <span class="token number">4'b1100</span><span class="token punctuation">:</span> 
                pos <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
            <span class="token number">4'b1000</span><span class="token punctuation">:</span> 
                pos <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
        <span class="token keyword">endcase</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>另一个就是，case虽然是分支判断，但是是有优先顺序的（这是这节叫做<strong>优先译码器</strong>的原因），在上面的情况是比在下面的情况优先级高的，在case里面不明显，是因为无论是0,1，x，z都是每个差一点都不行，所以情况和情况之间不会有<strong>重叠</strong>，但是在casez和casex中就会有区别。</p>
<h4 id="4-4-7-Priority-encoder-with-casez"><a href="#4-4-7-Priority-encoder-with-casez" class="headerlink" title="4.4.7 Priority encoder with casez"></a>4.4.7 Priority encoder with casez</h4><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> in<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> pos  <span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>
        <span class="token function">casez</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span>
            <span class="token number">8'bzzzzzzz1</span><span class="token punctuation">:</span> pos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token number">8'bzzzzzz1z</span><span class="token punctuation">:</span> pos <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token number">8'bzzzzz1zz</span><span class="token punctuation">:</span> pos <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
            <span class="token number">8'bzzzz1zzz</span><span class="token punctuation">:</span> pos <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
            <span class="token number">8'bzzz1zzzz</span><span class="token punctuation">:</span> pos <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
            <span class="token number">8'bzz1zzzzz</span><span class="token punctuation">:</span> pos <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
            <span class="token number">8'bz1zzzzzz</span><span class="token punctuation">:</span> pos <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>
            <span class="token number">8'b1zzzzzzz</span><span class="token punctuation">:</span> pos <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token punctuation">:</span> pos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">endcase</span>
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>首先先介绍一下x和z。x是<strong>不定态</strong>，也就是说，其状态<strong>不可知</strong>，在verilog中，比较运算符“\==”如果比较的位数中含有x或者z，就会输出x，但是如果用” \=== “就不会有这种输出，“===”会逐位比较，包括只有x和z都相等的时候，就会输出1，否则输出0。z是高阻态，在实际电路中，开关断开（没有驱动）就意味着高阻态（断路电阻视为很大）。</p>
<p>但是casex和casez跟上面讲的东西一毛钱关系都没有。casex和casez说的是如果情况中的某一位值是x或z（对应），那么就不比较他们了，就比较其他的不是x或z的位，这样就会造成情况的<strong>重叠</strong>，但是正如前一道题目叙述，<strong>优先译码器</strong>的特性得到了用武之地。</p>
<h3 id="4-5-More-Verilog-Features"><a href="#4-5-More-Verilog-Features" class="headerlink" title="4.5 More Verilog Features"></a>4.5 More Verilog Features</h3><h4 id="4-5-1-Conditional-ternary-operator"><a href="#4-5-1-Conditional-ternary-operator" class="headerlink" title="4.5.1 Conditional ternary operator"></a>4.5.1 Conditional ternary operator</h4><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> min<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//</span>
	
    <span class="token keyword">wire</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> tmp1<span class="token punctuation">,</span> tmp2<span class="token punctuation">;</span>
    
    <span class="token keyword">assign</span> tmp1 <span class="token operator">=</span> <span class="token punctuation">(</span>a <span class="token operator">&lt;</span> b<span class="token punctuation">)</span> <span class="token operator">?</span> a <span class="token punctuation">:</span> b<span class="token punctuation">;</span>
    <span class="token keyword">assign</span> tmp2 <span class="token operator">=</span> <span class="token punctuation">(</span>c <span class="token operator">&lt;</span> d<span class="token punctuation">)</span> <span class="token operator">?</span> c <span class="token punctuation">:</span> d<span class="token punctuation">;</span>
    <span class="token keyword">assign</span> min <span class="token operator">=</span> <span class="token punctuation">(</span>tmp1 <span class="token operator">&lt;</span> tmp2<span class="token punctuation">)</span> <span class="token operator">?</span> tmp1 <span class="token punctuation">:</span> tmp2<span class="token punctuation">;</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>需要强调，无论串连多少个三目运算符，都是一个式子，也就是说，signed这个，会被后面的某个unsigneded同化，所以其实assign三目是种很不好的语言，我看过激进的观点是抛弃assign，完全用Always代替，也不无可取之处。</p>
<h4 id="4-5-2-Reduction-operators"><a href="#4-5-2-Reduction-operators" class="headerlink" title="4.5.2 Reduction operators"></a>4.5.2 Reduction operators</h4><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> in<span class="token punctuation">,</span>
    <span class="token keyword">output</span> parity<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    
    <span class="token keyword">assign</span> parity <span class="token operator">=</span> <span class="token operator">^</span>in<span class="token punctuation">;</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="4-5-3-Reduction：Even-wider-gates"><a href="#4-5-3-Reduction：Even-wider-gates" class="headerlink" title="4.5.3 Reduction：Even wider gates"></a>4.5.3 Reduction：Even wider gates</h4><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span> 
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">99</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> in<span class="token punctuation">,</span>
    <span class="token keyword">output</span> out_and<span class="token punctuation">,</span>
    <span class="token keyword">output</span> out_or<span class="token punctuation">,</span>
    <span class="token keyword">output</span> out_xor 
<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">assign</span> out_and <span class="token operator">=</span> <span class="token operator">&amp;</span>in<span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out_or <span class="token operator">=</span> <span class="token operator">|</span>in<span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out_xor <span class="token operator">=</span> <span class="token operator">^</span>in<span class="token punctuation">;</span>
    
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="4-5-4-Combinational-for-loop：Vector-reversal2"><a href="#4-5-4-Combinational-for-loop：Vector-reversal2" class="headerlink" title="4.5.4 Combinational for-loop：Vector reversal2"></a>4.5.4 Combinational for-loop：Vector reversal2</h4><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span> 
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">99</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> in<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">99</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> out
<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">generate</span>
       <span class="token keyword">genvar</span> i<span class="token punctuation">;</span>
       <span class="token function">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token keyword">begin</span><span class="token punctuation">:</span>reverse
           <span class="token keyword">assign</span> out<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> in<span class="token punctuation">[</span><span class="token number">99</span> <span class="token operator">-</span> i<span class="token punctuation">]</span><span class="token punctuation">;</span>
       <span class="token keyword">end</span>
   <span class="token keyword">endgenerate</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>for循环来描述行为</strong>在4.2.7中已经系统介绍过了，这里想说的是，还有一个东西看上去<strong>很过程</strong>（跟for一样），但是也可以用来描述硬件，就是<strong>整数</strong>，后面会有关于FSM的设计，里面如果条件复杂一些，就会用到一些比如<strong>计数寄存器</strong>，而寄存器本质是一种<strong>简单的FSM</strong>，所以写起来bug很多（时序问题），但是如果用<strong>整型</strong>实现计数功能，就不会有这种困扰，应当灵活一些。</p>
<h4 id="4-5-5-Combinational-for-loop：255-bit-population-count"><a href="#4-5-5-Combinational-for-loop：255-bit-population-count" class="headerlink" title="4.5.5 Combinational for-loop：255-bit population count"></a>4.5.5 Combinational for-loop：255-bit population count</h4><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span> 
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">254</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> in<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> out <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">integer</span> i<span class="token punctuation">;</span>
    <span class="token important">always@</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token keyword">begin</span>
        out <span class="token operator">=</span> <span class="token number">1'b0</span><span class="token punctuation">;</span>
        <span class="token function">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span> <span class="token number">255</span><span class="token punctuation">;</span>i<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">begin</span>
            out <span class="token operator">=</span> out <span class="token operator">+</span> in<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> 
        <span class="token keyword">end</span>  
    <span class="token keyword">end</span>
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这个实现的是logisim中bitadder的功能，可以说，虽然for不太自然，但是面对这样的功能，这个已经很自然了。</p>
<p>而且居然是可以综合的，我能看懂的部分用到了异或门。</p>
<h4 id="4-5-6-Generate-for-loop：100-bit-binary-adder2"><a href="#4-5-6-Generate-for-loop：100-bit-binary-adder2" class="headerlink" title="4.5.6 Generate for-loop：100-bit binary adder2"></a>4.5.6 Generate for-loop：100-bit binary adder2</h4><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span> 
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">99</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span>
    <span class="token keyword">input</span> cin<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">99</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> cout<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">99</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> sum <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">integer</span> i<span class="token punctuation">;</span>
    <span class="token important">always@</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token keyword">begin</span>
        <span class="token operator">{</span>cout<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>sum<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">}</span> <span class="token operator">=</span> a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span>b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span>cin<span class="token punctuation">;</span> 
        <span class="token function">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span>i<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">begin</span>
            <span class="token operator">{</span>cout<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>sum<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">}</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+</span>b<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+</span>cout<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这里是没有用生成块的，主要是为了适应这种<strong>过于过程</strong>的for。</p>
<h4 id="4-5-7-Generate-for-loop：100-digit-BCD-adder"><a href="#4-5-7-Generate-for-loop：100-digit-BCD-adder" class="headerlink" title="4.5.7 Generate for-loop：100-digit BCD adder"></a>4.5.7 Generate for-loop：100-digit BCD adder</h4><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span> 
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">399</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span>
    <span class="token keyword">input</span> cin<span class="token punctuation">,</span>
    <span class="token keyword">output</span> cout<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">399</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> sum <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">wire</span><span class="token punctuation">[</span><span class="token number">99</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>    cout_1<span class="token punctuation">;</span>
    <span class="token keyword">generate</span>
        <span class="token keyword">genvar</span> i<span class="token punctuation">;</span>
        <span class="token function">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">99</span><span class="token punctuation">;</span> i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">begin</span><span class="token punctuation">:</span>adder
            <span class="token function">if</span><span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token keyword">begin</span>
                bcd_fadd <span class="token function">u_bcd_fadd</span><span class="token punctuation">(</span>
                    <span class="token punctuation">.</span>a <span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">.</span>b <span class="token punctuation">(</span>b<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">.</span>cin <span class="token punctuation">(</span>cin<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">.</span>sum <span class="token punctuation">(</span>sum<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">.</span>cout <span class="token punctuation">(</span>cout_1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">end</span>
            <span class="token keyword">else</span> <span class="token keyword">begin</span>
                bcd_fadd <span class="token function">ui_bcd_fadd</span><span class="token punctuation">(</span>
                    <span class="token punctuation">.</span>a <span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">4</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">:</span> <span class="token number">4</span> <span class="token operator">*</span> i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">.</span>b <span class="token punctuation">(</span>b<span class="token punctuation">[</span><span class="token number">4</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">:</span> <span class="token number">4</span> <span class="token operator">*</span> i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">.</span>cin <span class="token punctuation">(</span>cout_1<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">.</span>sum <span class="token punctuation">(</span>sum<span class="token punctuation">[</span><span class="token number">4</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">:</span> <span class="token number">4</span> <span class="token operator">*</span> i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">.</span>cout <span class="token punctuation">(</span>cout_1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">end</span>
        <span class="token keyword">end</span>
        <span class="token keyword">assign</span> cout <span class="token operator">=</span> cout_1<span class="token punctuation">[</span><span class="token number">99</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">endgenerate</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>像<strong>模块实例化</strong>这种东西，就没办法用<strong>for行为</strong>来代替了，可见生成块是没有办法完全被其他语句替代的，所以还是需要好好学习的。</p>
<hr>
<h2 id="五、Circuit"><a href="#五、Circuit" class="headerlink" title="五、Circuit"></a>五、Circuit</h2><h3 id="5-1-Combinational-Logic"><a href="#5-1-Combinational-Logic" class="headerlink" title="5.1 Combinational Logic"></a>5.1 Combinational Logic</h3><h4 id="5-1-1-Basic-Gates"><a href="#5-1-1-Basic-Gates" class="headerlink" title="5.1.1 Basic Gates"></a>5.1.1 Basic Gates</h4><h5 id="5-1-1-1-Wire"><a href="#5-1-1-1-Wire" class="headerlink" title="5.1.1.1 Wire"></a>5.1.1.1 Wire</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">input</span> in<span class="token punctuation">,</span>
    <span class="token keyword">output</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">assign</span> out <span class="token operator">=</span> in<span class="token punctuation">;</span>
    
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>在整个第五章，我们会把整个常见的硬件全都用verilog写一遍，才能切实体会<strong>硬件设计</strong>的思想。要清楚语言与实际电路的对应关系。</p>
<h5 id="5-1-1-2-GND"><a href="#5-1-1-2-GND" class="headerlink" title="5.1.1.2 GND"></a>5.1.1.2 GND</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">output</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
	<span class="token keyword">assign</span> out <span class="token operator">=</span> <span class="token number">1'b0</span><span class="token punctuation">;</span>
	
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="5-1-1-2-NOR"><a href="#5-1-1-2-NOR" class="headerlink" title="5.1.1.2 NOR"></a>5.1.1.2 NOR</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">input</span> in1<span class="token punctuation">,</span>
    <span class="token keyword">input</span> in2<span class="token punctuation">,</span>
    <span class="token keyword">output</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">assign</span> out <span class="token operator">=</span> <span class="token operator">~</span><span class="token punctuation">(</span>in1 <span class="token operator">|</span> in2<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="5-1-1-3-Another-gate"><a href="#5-1-1-3-Another-gate" class="headerlink" title="5.1.1.3 Another gate"></a>5.1.1.3 Another gate</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">input</span> in1<span class="token punctuation">,</span>
    <span class="token keyword">input</span> in2<span class="token punctuation">,</span>
    <span class="token keyword">output</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">assign</span> out <span class="token operator">=</span> in1 <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token operator">~</span>in2<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="5-1-1-4-Two-gates"><a href="#5-1-1-4-Two-gates" class="headerlink" title="5.1.1.4 Two gates"></a>5.1.1.4 Two gates</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">input</span> in1<span class="token punctuation">,</span>
    <span class="token keyword">input</span> in2<span class="token punctuation">,</span>
    <span class="token keyword">input</span> in3<span class="token punctuation">,</span>
    <span class="token keyword">output</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">assign</span> out <span class="token operator">=</span> in3 <span class="token operator">^</span> <span class="token punctuation">(</span><span class="token operator">~</span><span class="token punctuation">(</span>in1 <span class="token operator">^</span> in2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="5-1-1-5-More-logic-gates"><a href="#5-1-1-5-More-logic-gates" class="headerlink" title="5.1.1.5 More logic gates"></a>5.1.1.5 More logic gates</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span> 
    <span class="token keyword">input</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span>
    <span class="token keyword">output</span> out_and<span class="token punctuation">,</span>
    <span class="token keyword">output</span> out_or<span class="token punctuation">,</span>
    <span class="token keyword">output</span> out_xor<span class="token punctuation">,</span>
    <span class="token keyword">output</span> out_nand<span class="token punctuation">,</span>
    <span class="token keyword">output</span> out_nor<span class="token punctuation">,</span>
    <span class="token keyword">output</span> out_xnor<span class="token punctuation">,</span>
    <span class="token keyword">output</span> out_anotb
<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out_and <span class="token operator">=</span> a <span class="token operator">&amp;</span> b<span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out_or <span class="token operator">=</span> a <span class="token operator">|</span> b<span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out_xor <span class="token operator">=</span> a <span class="token operator">^</span> b<span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out_nand <span class="token operator">=</span> <span class="token operator">~</span><span class="token punctuation">(</span>a <span class="token operator">&amp;</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out_nor <span class="token operator">=</span> <span class="token operator">~</span><span class="token punctuation">(</span>a <span class="token operator">|</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out_xnor <span class="token operator">=</span> <span class="token operator">~</span><span class="token punctuation">(</span>a <span class="token operator">^</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out_anotb <span class="token operator">=</span> a <span class="token operator">&amp;</span> <span class="token operator">~</span>b<span class="token punctuation">;</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="5-1-1-6-7420-chip"><a href="#5-1-1-6-7420-chip" class="headerlink" title="5.1.1.6 7420 chip"></a>5.1.1.6 7420 chip</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span> 
    <span class="token keyword">input</span> p1a<span class="token punctuation">,</span> p1b<span class="token punctuation">,</span> p1c<span class="token punctuation">,</span> p1d<span class="token punctuation">,</span>
    <span class="token keyword">output</span> p1y<span class="token punctuation">,</span>
    <span class="token keyword">input</span> p2a<span class="token punctuation">,</span> p2b<span class="token punctuation">,</span> p2c<span class="token punctuation">,</span> p2d<span class="token punctuation">,</span>
    <span class="token keyword">output</span> p2y <span class="token punctuation">)</span><span class="token punctuation">;</span>
	
    <span class="token keyword">assign</span> p1y <span class="token operator">=</span> <span class="token operator">~</span><span class="token punctuation">(</span>p1a <span class="token operator">&amp;</span> p1b <span class="token operator">&amp;</span> p1c <span class="token operator">&amp;</span> p1d<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> p2y <span class="token operator">=</span> <span class="token operator">~</span><span class="token punctuation">(</span>p2a <span class="token operator">&amp;</span> p2b <span class="token operator">&amp;</span> p2c <span class="token operator">&amp;</span> p2d<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="5-1-1-7-Truth-tables"><a href="#5-1-1-7-Truth-tables" class="headerlink" title="5.1.1.7 Truth tables"></a>5.1.1.7 Truth tables</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span> 
    <span class="token keyword">input</span> x3<span class="token punctuation">,</span>
    <span class="token keyword">input</span> x2<span class="token punctuation">,</span>
    <span class="token keyword">input</span> x1<span class="token punctuation">,</span>  <span class="token comment">// three inputs</span>
    <span class="token keyword">output</span> f   <span class="token comment">// one output</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">assign</span> f <span class="token operator">=</span> x2 <span class="token operator">&amp;</span> <span class="token operator">~</span>x3 <span class="token operator">|</span> x1 <span class="token operator">&amp;</span> x3<span class="token punctuation">;</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这道题是真值表和最小项的应用，我一直觉得这个是组合逻辑最强大的地方，通过简单的逻辑运算，就可以描述复杂的事务，大概就是《三体》里描述的场景吧。</p>
<h5 id="5-1-1-8-Two-bit-equality"><a href="#5-1-1-8-Two-bit-equality" class="headerlink" title="5.1.1.8 Two-bit equality"></a>5.1.1.8 Two-bit equality</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span> <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> A<span class="token punctuation">,</span> <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> B<span class="token punctuation">,</span> <span class="token keyword">output</span> z <span class="token punctuation">)</span><span class="token punctuation">;</span> 
    
    <span class="token keyword">assign</span> z <span class="token operator">=</span> <span class="token punctuation">(</span>A <span class="token operator">==</span> B<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="5-1-1-9-Simple-circuit-A"><a href="#5-1-1-9-Simple-circuit-A" class="headerlink" title="5.1.1.9 Simple circuit A"></a>5.1.1.9 Simple circuit A</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span><span class="token keyword">input</span> x<span class="token punctuation">,</span> <span class="token keyword">input</span> y<span class="token punctuation">,</span> <span class="token keyword">output</span> z<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">assign</span> z <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token operator">^</span>y<span class="token punctuation">)</span> <span class="token operator">&amp;</span> x<span class="token punctuation">;</span>
    
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="5-1-1-10-Simple-circuit-B"><a href="#5-1-1-10-Simple-circuit-B" class="headerlink" title="5.1.1.10 Simple circuit B"></a>5.1.1.10 Simple circuit B</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span> <span class="token keyword">input</span> x<span class="token punctuation">,</span> <span class="token keyword">input</span> y<span class="token punctuation">,</span> <span class="token keyword">output</span> z <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">assign</span> z <span class="token operator">=</span> <span class="token operator">~</span><span class="token punctuation">(</span>x <span class="token operator">^</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="5-1-1-11-Combine-circuits-A-and-B"><a href="#5-1-1-11-Combine-circuits-A-and-B" class="headerlink" title="5.1.1.11 Combine circuits A and B"></a>5.1.1.11 Combine circuits A and B</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span><span class="token keyword">input</span> x<span class="token punctuation">,</span> <span class="token keyword">input</span> y<span class="token punctuation">,</span> <span class="token keyword">output</span> z<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
    <span class="token keyword">wire</span> tmp1<span class="token punctuation">,</span> tmp2<span class="token punctuation">,</span> tmp3<span class="token punctuation">,</span> tmp4<span class="token punctuation">;</span>
    A <span class="token function">A1</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> tmp1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    B <span class="token function">B1</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> tmp2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    A <span class="token function">A2</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> tmp3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    B <span class="token function">B2</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> tmp4<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">assign</span> z <span class="token operator">=</span> <span class="token punctuation">(</span>tmp1 <span class="token operator">|</span> tmp2<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>tmp3 <span class="token operator">&amp;</span> tmp4<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token keyword">endmodule</span>

<span class="token keyword">module</span> A <span class="token punctuation">(</span><span class="token keyword">input</span> x<span class="token punctuation">,</span> <span class="token keyword">input</span> y<span class="token punctuation">,</span> <span class="token keyword">output</span> z<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">assign</span> z <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token operator">^</span>y<span class="token punctuation">)</span> <span class="token operator">&amp;</span> x<span class="token punctuation">;</span>
    
<span class="token keyword">endmodule</span>

<span class="token keyword">module</span> B <span class="token punctuation">(</span> <span class="token keyword">input</span> x<span class="token punctuation">,</span> <span class="token keyword">input</span> y<span class="token punctuation">,</span> <span class="token keyword">output</span> z <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">assign</span> z <span class="token operator">=</span> <span class="token operator">~</span><span class="token punctuation">(</span>x <span class="token operator">^</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="5-1-1-12-Ring-or-virbrate"><a href="#5-1-1-12-Ring-or-virbrate" class="headerlink" title="5.1.1.12 Ring or virbrate"></a>5.1.1.12 Ring or virbrate</h5><pre class="line-numbers language-none"><code class="language-none">module top_module (
    input ring,
    input vibrate_mode,
    output ringer,       // Make sound
    output motor         // Vibrate
);

    assign ringer = ~vibrate_mode &amp; ring;
    assign motor = vibrate_mode &amp; ring;
    
endmodule<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>无聊的应用题。</p>
<h5 id="5-1-1-13-Thermostat"><a href="#5-1-1-13-Thermostat" class="headerlink" title="5.1.1.13 Thermostat"></a>5.1.1.13 Thermostat</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">input</span> too_cold<span class="token punctuation">,</span>
    <span class="token keyword">input</span> too_hot<span class="token punctuation">,</span>
    <span class="token keyword">input</span> mode<span class="token punctuation">,</span>
    <span class="token keyword">input</span> fan_on<span class="token punctuation">,</span>
    <span class="token keyword">output</span> heater<span class="token punctuation">,</span>
    <span class="token keyword">output</span> aircon<span class="token punctuation">,</span>
    <span class="token keyword">output</span> fan
<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token keyword">assign</span> heater <span class="token operator">=</span> mode <span class="token operator">&amp;</span> too_cold<span class="token punctuation">;</span>
    <span class="token keyword">assign</span> aircon <span class="token operator">=</span> <span class="token operator">~</span>mode <span class="token operator">&amp;</span> too_hot<span class="token punctuation">;</span>
    <span class="token keyword">assign</span> fan <span class="token operator">=</span> <span class="token punctuation">(</span>mode <span class="token operator">&amp;</span> too_cold<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token operator">~</span>mode <span class="token operator">&amp;</span> too_hot<span class="token punctuation">)</span> <span class="token operator">|</span> fan_on<span class="token punctuation">;</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>另一道无聊的应用题。</p>
<h5 id="5-1-1-14-3-bit-population-count"><a href="#5-1-1-14-3-bit-population-count" class="headerlink" title="5.1.1.14 3-bit population count"></a>5.1.1.14 3-bit population count</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span> 
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> in<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> out <span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span><span class="token comment">//这里赋初值很重要，忘了就错了</span>
        out <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token function">for</span><span class="token punctuation">(</span><span class="token keyword">integer</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
            out <span class="token operator">=</span> out <span class="token operator">+</span> in<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这里讲解一下<strong>初始值</strong>问题，当声明变量的时候，如果不赋值，那么wire类型初值是z，整数和寄存器都是x，这很符合实际情况，wire没有驱动的时候是高阻态，而综合后与门电路相关的整数和寄存器，都是与<strong>门电路</strong>相关，而门电路是有驱动的（这里说的是不是输入的驱动），所以应该是不定态x。</p>
<p>另外再次强调，计数用整型真的比寄存器好使。</p>
<h5 id="5-1-1-15-Gates-and-vectors"><a href="#5-1-1-15-Gates-and-vectors" class="headerlink" title="5.1.1.15 Gates and vectors"></a>5.1.1.15 Gates and vectors</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span> 
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> in<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> out_both<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">]</span> out_any<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> out_different <span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">assign</span> out_both <span class="token operator">=</span> in<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> in<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//这里就不能直接用0了，就必须指明位宽了</span>
    <span class="token keyword">assign</span> out_any <span class="token operator">=</span> in<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">|</span> in<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out_different <span class="token operator">=</span> in <span class="token operator">^</span> <span class="token operator">{</span>in<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> in<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">}</span><span class="token punctuation">;</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="5-1-1-16-even-longer-Vectors"><a href="#5-1-1-16-even-longer-Vectors" class="headerlink" title="5.1.1.16 even longer Vectors"></a>5.1.1.16 even longer Vectors</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span> 
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">99</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> in<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">98</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> out_both<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">99</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">]</span> out_any<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">99</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> out_different <span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">assign</span> out_both <span class="token operator">=</span> in<span class="token punctuation">[</span><span class="token number">98</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> in<span class="token punctuation">[</span><span class="token number">99</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out_any <span class="token operator">=</span> in<span class="token punctuation">[</span><span class="token number">98</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">|</span> in<span class="token punctuation">[</span><span class="token number">99</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> out_different <span class="token operator">=</span> in<span class="token punctuation">[</span><span class="token number">99</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">^</span> <span class="token operator">{</span>in<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> in<span class="token punctuation">[</span><span class="token number">99</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">}</span><span class="token punctuation">;</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="5-1-2-Multiplexers"><a href="#5-1-2-Multiplexers" class="headerlink" title="5.1.2 Multiplexers"></a>5.1.2 Multiplexers</h4><h5 id="5-1-2-1-2-to-1-multiplexer"><a href="#5-1-2-1-2-to-1-multiplexer" class="headerlink" title="5.1.2.1 2-to-1 multiplexer"></a>5.1.2.1 2-to-1 multiplexer</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span> 
    <span class="token keyword">input</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> sel<span class="token punctuation">,</span>
    <span class="token keyword">output</span> out <span class="token punctuation">)</span><span class="token punctuation">;</span> 
    
    <span class="token keyword">assign</span> out <span class="token operator">=</span> <span class="token punctuation">(</span>sel <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> a <span class="token punctuation">:</span> b<span class="token punctuation">;</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="5-1-2-2-2-to-1-bus-multiplexer"><a href="#5-1-2-2-2-to-1-bus-multiplexer" class="headerlink" title="5.1.2.2 2-to-1 bus multiplexer"></a>5.1.2.2 2-to-1 bus multiplexer</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span> 
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">99</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span>
    <span class="token keyword">input</span> sel<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">99</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> out <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">assign</span> out <span class="token operator">=</span> <span class="token punctuation">(</span>sel <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> a <span class="token punctuation">:</span> b<span class="token punctuation">;</span>
    
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>还是感叹向量和标量在处理上的一致性，刚学高代的时候感觉向量很不自然，现在看还是见识太少了。</p>
<h5 id="5-1-2-3-9-to-1-multiplexer"><a href="#5-1-2-3-9-to-1-multiplexer" class="headerlink" title="5.1.2.3 9-to-1 multiplexer"></a>5.1.2.3 9-to-1 multiplexer</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span> 
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> e<span class="token punctuation">,</span> f<span class="token punctuation">,</span> g<span class="token punctuation">,</span> h<span class="token punctuation">,</span> i<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> sel<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> out <span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>
        <span class="token function">case</span><span class="token punctuation">(</span>sel<span class="token punctuation">)</span>
            <span class="token number">0</span><span class="token punctuation">:</span> out <span class="token operator">=</span> a<span class="token punctuation">;</span>
            <span class="token number">1</span><span class="token punctuation">:</span> out <span class="token operator">=</span> b<span class="token punctuation">;</span>
            <span class="token number">2</span><span class="token punctuation">:</span> out <span class="token operator">=</span> c<span class="token punctuation">;</span>
            <span class="token number">3</span><span class="token punctuation">:</span> out <span class="token operator">=</span> d<span class="token punctuation">;</span>
            <span class="token number">4</span><span class="token punctuation">:</span> out <span class="token operator">=</span> e<span class="token punctuation">;</span>
            <span class="token number">5</span><span class="token punctuation">:</span> out <span class="token operator">=</span> f<span class="token punctuation">;</span>
            <span class="token number">6</span><span class="token punctuation">:</span> out <span class="token operator">=</span> g<span class="token punctuation">;</span>
            <span class="token number">7</span><span class="token punctuation">:</span> out <span class="token operator">=</span> h<span class="token punctuation">;</span>
            <span class="token number">8</span><span class="token punctuation">:</span> out <span class="token operator">=</span> i<span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token punctuation">:</span> out <span class="token operator">=</span> <span class="token operator">{</span><span class="token number">16</span><span class="token operator">{</span><span class="token number">1'b1</span><span class="token operator">}}</span><span class="token punctuation">;</span>
        <span class="token keyword">endcase</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>当输入一多，case就变得有用了，数据流级的建模就不如行为级好了。</p>
<h5 id="5-1-2-4-256-to-1-multiplexer"><a href="#5-1-2-4-256-to-1-multiplexer" class="headerlink" title="5.1.2.4 256-to-1 multiplexer"></a>5.1.2.4 256-to-1 multiplexer</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span> 
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">255</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> in<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> sel<span class="token punctuation">,</span>
    <span class="token keyword">output</span> out <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">assign</span> out <span class="token operator">=</span> in<span class="token punctuation">[</span>sel<span class="token punctuation">]</span><span class="token punctuation">;</span>
    
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这里提供了一个更好的想法，利用数组索引，来进行位访问，在之前的题中也可以应用，可以说这个是最优雅的方法了。</p>
<h5 id="5-1-2-5-256-to-1-4-bit-multiplexer"><a href="#5-1-2-5-256-to-1-4-bit-multiplexer" class="headerlink" title="5.1.2.5 256-to-1 4-bit multiplexer"></a>5.1.2.5 256-to-1 4-bit multiplexer</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span> 
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">1023</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> in<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> sel<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> out <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">assign</span> out <span class="token operator">=</span> in<span class="token punctuation">[</span>sel <span class="token operator">*</span> <span class="token number">4</span> <span class="token operator">+</span> <span class="token number">3</span> <span class="token operator">-</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">//assign out = in[sel*4 +: 4];</span>
    <span class="token comment">//assign out = {in[sel*4+3], in[sel*4+2], in[sel*4+1], in[sel*4+0]};</span>
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这些写法都是可以的，包括注释里面的。但是下面这种写法是不可以的：</p>
<pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span> 
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">1023</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> in<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> sel<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> out <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">assign</span> out <span class="token operator">=</span> in<span class="token punctuation">[</span>sel <span class="token operator">*</span> <span class="token number">4</span> <span class="token operator">+</span> <span class="token number">3</span> <span class="token punctuation">:</span> sel<span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>据说是因为sel是这个选择里没有常量。但我觉得只是语法规定。</p>
<h4 id="5-1-3-Arithmetic-Circuits"><a href="#5-1-3-Arithmetic-Circuits" class="headerlink" title="5.1.3 Arithmetic Circuits"></a>5.1.3 Arithmetic Circuits</h4><h5 id="5-1-3-1-half-adder"><a href="#5-1-3-1-half-adder" class="headerlink" title="5.1.3.1 half-adder"></a>5.1.3.1 half-adder</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span> 
    <span class="token keyword">input</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span>
    <span class="token keyword">output</span> cout<span class="token punctuation">,</span> sum <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">assign</span> <span class="token operator">{</span>cout<span class="token punctuation">,</span> sum<span class="token operator">}</span> <span class="token operator">=</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
    
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>半加器就是不考虑进位的加法器。</p>
<h5 id="5-1-3-2-Full-adder"><a href="#5-1-3-2-Full-adder" class="headerlink" title="5.1.3.2 Full adder"></a>5.1.3.2 Full adder</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span> 
    <span class="token keyword">input</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> cin<span class="token punctuation">,</span>
    <span class="token keyword">output</span> cout<span class="token punctuation">,</span> sum <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">assign</span> <span class="token operator">{</span>cout<span class="token punctuation">,</span> sum<span class="token operator">}</span> <span class="token operator">=</span> a <span class="token operator">+</span> b <span class="token operator">+</span> cin<span class="token punctuation">;</span>
    
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>全加器是考虑进位的加法器。</p>
<h5 id="5-1-3-3-3-bit-binary-adder"><a href="#5-1-3-3-3-bit-binary-adder" class="headerlink" title="5.1.3.3 3-bit binary adder"></a>5.1.3.3 3-bit binary adder</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span> 
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span>
    <span class="token keyword">input</span> cin<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> cout<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> sum <span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    fadd <span class="token function">add0</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cin<span class="token punctuation">,</span> cout<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> sum<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fadd <span class="token function">add1</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> b<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cout<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cout<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> sum<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fadd <span class="token function">add2</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> b<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cout<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cout<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> sum<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">endmodule</span>

<span class="token keyword">module</span> <span class="token function">fadd</span><span class="token punctuation">(</span> 
    <span class="token keyword">input</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> cin<span class="token punctuation">,</span>
    <span class="token keyword">output</span> cout<span class="token punctuation">,</span> sum <span class="token punctuation">)</span><span class="token punctuation">;</span>
	
    <span class="token keyword">assign</span> <span class="token operator">{</span>cout<span class="token punctuation">,</span> sum<span class="token operator">}</span> <span class="token operator">=</span> a <span class="token operator">+</span> b <span class="token operator">+</span>cin<span class="token punctuation">;</span>
    
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="5-1-3-4-Adder"><a href="#5-1-3-4-Adder" class="headerlink" title="5.1.3.4 Adder"></a>5.1.3.4 Adder</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> x<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> y<span class="token punctuation">,</span> 
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> sum<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">assign</span> sum <span class="token operator">=</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>
    
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这个例子结合上面的，再次告诉我们数据流级建模的强大。</p>
<h5 id="5-1-3-5-Signed-addition-overflow"><a href="#5-1-3-5-Signed-addition-overflow" class="headerlink" title="5.1.3.5 Signed addition overflow"></a>5.1.3.5 Signed addition overflow</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> a<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> b<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> s<span class="token punctuation">,</span>
    <span class="token keyword">output</span> overflow
<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token keyword">assign</span> s<span class="token operator">=</span>a <span class="token operator">+</span> b<span class="token punctuation">;</span>
    <span class="token keyword">assign</span> overflow<span class="token operator">=</span>a<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> b<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token operator">~</span>s<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token operator">~</span>a<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token operator">~</span>b<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> s<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这道题目用的是真值表法判断溢出，但是其实课堂介绍的是用的另一种方法：</p>
<p>Cs是符号位的进位，Cp是最高数值位的进位，如果两者相同，就没有溢出，如果不同，就溢出了，具体的证明在我的博客里有<a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/living_frontier/article/details/120583473">硬件中的数_living_frontier的博客-CSDN博客</a>。但是为什么没有用到这个方法呢，是因为我们用的是数据流级的描述，没有办法探查具体每一位的情况的，即使写成这样</p>
<pre class="line-numbers language-none"><code class="language-none">module top_module (
    input [7:0] a,
    input [7:0] b,
    output [7:0] s,
    output overflow
); 
    wire cs, cp;
    
    assign s=a + b;
    assign cs = a[7] &amp; b[7];
    assign cp = a[6] &amp; b[6];
    assign overflow = cs ^ cp;

endmodule<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>是错误的，是因为这些位的进位是还跟更低位有关，比如cp就不止和a[6]和b[6]有关，还跟第5位的cout有关，那么cout又跟第四位的cout有关，如此是没有办法写清楚的，但是在硬件实现中，这个问题是很好解决的（甚至不用解决，连出两根线就可以了），所以还是要注意非结构描述的代价。</p>
<h5 id="5-1-3-6-100-bit-binary-adder"><a href="#5-1-3-6-100-bit-binary-adder" class="headerlink" title="5.1.3.6 100-bit binary adder"></a>5.1.3.6 100-bit binary adder</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span> 
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">99</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span>
    <span class="token keyword">input</span> cin<span class="token punctuation">,</span>
    <span class="token keyword">output</span> cout<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">99</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> sum <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">assign</span> <span class="token operator">{</span>cout<span class="token punctuation">,</span> sum<span class="token operator">}</span> <span class="token operator">=</span> a <span class="token operator">+</span> b <span class="token operator">+</span> cin<span class="token punctuation">;</span>
    
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="5-1-3-7-4-digit-BCD-adder"><a href="#5-1-3-7-4-digit-BCD-adder" class="headerlink" title="5.1.3.7 4-digit BCD adder"></a>5.1.3.7 4-digit BCD adder</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span> 
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span>
    <span class="token keyword">input</span> cin<span class="token punctuation">,</span>
    <span class="token keyword">output</span> cout<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> sum <span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">wire</span> cout1<span class="token punctuation">,</span> cout2<span class="token punctuation">,</span> cout3<span class="token punctuation">;</span>
    adder <span class="token function">a1</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> b<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cin<span class="token punctuation">,</span> sum<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cout1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    adder <span class="token function">a2</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> b<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cout1<span class="token punctuation">,</span> sum<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cout2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    adder <span class="token function">a3</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> b<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cout2<span class="token punctuation">,</span> sum<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cout3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    adder <span class="token function">a4</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">,</span> b<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cout3<span class="token punctuation">,</span> sum<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cout<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">endmodule</span>

<span class="token keyword">module</span> <span class="token function">adder</span><span class="token punctuation">(</span><span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> a<span class="token punctuation">,</span> <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> b<span class="token punctuation">,</span> <span class="token keyword">input</span> cin<span class="token punctuation">,</span> <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> sum<span class="token punctuation">,</span> <span class="token keyword">output</span> cout<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> sum <span class="token operator">=</span> <span class="token punctuation">(</span>a <span class="token operator">+</span> b <span class="token operator">+</span> cin <span class="token operator">&gt;=</span> <span class="token number">'d10</span><span class="token punctuation">)</span><span class="token operator">?</span> a <span class="token operator">+</span> b <span class="token operator">+</span> cin <span class="token operator">-</span> <span class="token number">4'd10</span> <span class="token punctuation">:</span> a <span class="token operator">+</span> b <span class="token operator">+</span> cin<span class="token punctuation">;</span>
    <span class="token keyword">assign</span> cout <span class="token operator">=</span> <span class="token punctuation">(</span>a <span class="token operator">+</span> b <span class="token operator">+</span> cin <span class="token operator">&gt;=</span> <span class="token number">'d10</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token number">1'd1</span> <span class="token punctuation">:</span> <span class="token number">1'd0</span><span class="token punctuation">;</span>
    <span class="token comment">//这里需要注意一下assign sum = (a + b + cin &gt;= 4'd10)? a + b + cin - 4'd10 : a + b + cin;是错误的。</span>
    <span class="token comment">//因为当比较的时候，会按照位宽较小的进行，如果a + b + cin超过16，就会变成 1_0000 &gt; 1010，进而变成0000 &gt; 1010</span>
    <span class="token comment">//造成错误</span>
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这里应用的思想其实与高精度加法类似。</p>
<p>另外需要注意的点就是溢出问题，还是很难发现的，需要多多留意，在注释里已经把原理讲解的很清楚了。</p>
<h4 id="5-1-4-Karnaugh-Map-to-Circuit"><a href="#5-1-4-Karnaugh-Map-to-Circuit" class="headerlink" title="5.1.4 Karnaugh Map to Circuit"></a>5.1.4 Karnaugh Map to Circuit</h4><h5 id="5-1-4-1-3-variable"><a href="#5-1-4-1-3-variable" class="headerlink" title="5.1.4.1 3-variable"></a>5.1.4.1 3-variable</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span>
    <span class="token keyword">input</span> a<span class="token punctuation">,</span>
    <span class="token keyword">input</span> b<span class="token punctuation">,</span>
    <span class="token keyword">input</span> c<span class="token punctuation">,</span>
    <span class="token keyword">output</span> out  <span class="token punctuation">)</span><span class="token punctuation">;</span> 

    <span class="token keyword">assign</span> out <span class="token operator">=</span> c <span class="token operator">|</span> b <span class="token operator">&amp;</span> <span class="token operator">~</span>c <span class="token operator">|</span> a <span class="token operator">&amp;</span> <span class="token operator">~</span>b<span class="token punctuation">;</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>关于卡诺图，其原理和威力在这篇博客中我介绍了，所以就不在这里赘述了。<a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/living_frontier/article/details/120720868">计组中的组合数学_living_frontier的博客-CSDN博客</a></p>
<h5 id="5-1-4-2-4-variable"><a href="#5-1-4-2-4-variable" class="headerlink" title="5.1.4.2 4-variable"></a>5.1.4.2 4-variable</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span>
    <span class="token keyword">input</span> a<span class="token punctuation">,</span>
    <span class="token keyword">input</span> b<span class="token punctuation">,</span>
    <span class="token keyword">input</span> c<span class="token punctuation">,</span>
    <span class="token keyword">input</span> d<span class="token punctuation">,</span>
    <span class="token keyword">output</span> out  <span class="token punctuation">)</span><span class="token punctuation">;</span> 

    <span class="token keyword">assign</span> out <span class="token operator">=</span> <span class="token operator">~</span>b <span class="token operator">&amp;</span> <span class="token operator">~</span>c <span class="token operator">|</span> <span class="token operator">~</span>a <span class="token operator">&amp;</span> <span class="token operator">~</span>d <span class="token operator">|</span> b <span class="token operator">&amp;</span> c <span class="token operator">&amp;</span>d <span class="token operator">|</span> a <span class="token operator">&amp;</span> c <span class="token operator">&amp;</span> d<span class="token punctuation">;</span>
    
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="5-1-4-3-4-variable"><a href="#5-1-4-3-4-variable" class="headerlink" title="5.1.4.3 4-variable"></a>5.1.4.3 4-variable</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span>
    <span class="token keyword">input</span> a<span class="token punctuation">,</span>
    <span class="token keyword">input</span> b<span class="token punctuation">,</span>
    <span class="token keyword">input</span> c<span class="token punctuation">,</span>
    <span class="token keyword">input</span> d<span class="token punctuation">,</span>
    <span class="token keyword">output</span> out  <span class="token punctuation">)</span><span class="token punctuation">;</span> 

    <span class="token keyword">assign</span> out <span class="token operator">=</span> a <span class="token operator">|</span> <span class="token operator">~</span>b <span class="token operator">&amp;</span> c <span class="token operator">|</span> b <span class="token operator">&amp;</span> <span class="token operator">~</span>c <span class="token operator">&amp;</span> <span class="token operator">~</span>d<span class="token punctuation">;</span>
    
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="5-1-4-4-4-variable"><a href="#5-1-4-4-4-variable" class="headerlink" title="5.1.4.4 4-variable"></a>5.1.4.4 4-variable</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span>
    <span class="token keyword">input</span> a<span class="token punctuation">,</span>
    <span class="token keyword">input</span> b<span class="token punctuation">,</span>
    <span class="token keyword">input</span> c<span class="token punctuation">,</span>
    <span class="token keyword">input</span> d<span class="token punctuation">,</span>
    <span class="token keyword">output</span> out  <span class="token punctuation">)</span><span class="token punctuation">;</span> 

    <span class="token keyword">assign</span> out <span class="token operator">=</span> a <span class="token operator">|</span> <span class="token operator">~</span>b <span class="token operator">&amp;</span> c <span class="token operator">|</span> b <span class="token operator">&amp;</span> <span class="token operator">~</span>c <span class="token operator">&amp;</span> <span class="token operator">~</span>d<span class="token punctuation">;</span>
    
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="5-1-4-5-4-variable"><a href="#5-1-4-5-4-variable" class="headerlink" title="5.1.4.5 4-variable"></a>5.1.4.5 4-variable</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span>
    <span class="token keyword">input</span> a<span class="token punctuation">,</span>
    <span class="token keyword">input</span> b<span class="token punctuation">,</span>
    <span class="token keyword">input</span> c<span class="token punctuation">,</span>
    <span class="token keyword">input</span> d<span class="token punctuation">,</span>
    <span class="token keyword">output</span> out  <span class="token punctuation">)</span><span class="token punctuation">;</span> 

    <span class="token keyword">assign</span> out <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">~</span>a<span class="token operator">&amp;</span>b<span class="token operator">&amp;~</span>c<span class="token operator">&amp;~</span>d<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>a<span class="token operator">&amp;~</span>b<span class="token operator">&amp;~</span>c<span class="token operator">&amp;~</span>d<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token operator">~</span>a<span class="token operator">&amp;~</span>b<span class="token operator">&amp;~</span>c<span class="token operator">&amp;</span>d<span class="token punctuation">)</span> <span class="token operator">|</span>  <span class="token punctuation">(</span>a<span class="token operator">&amp;</span>b<span class="token operator">&amp;~</span>c<span class="token operator">&amp;</span>d<span class="token punctuation">)</span> <span class="token operator">|</span>  <span class="token punctuation">(</span><span class="token operator">~</span>a<span class="token operator">&amp;</span>b<span class="token operator">&amp;</span>c<span class="token operator">&amp;</span>d<span class="token punctuation">)</span> <span class="token operator">|</span>  <span class="token punctuation">(</span>a<span class="token operator">&amp;~</span>b<span class="token operator">&amp;</span>c<span class="token operator">&amp;</span>d<span class="token punctuation">)</span> <span class="token operator">|</span>  <span class="token punctuation">(</span><span class="token operator">~</span>a<span class="token operator">&amp;~</span>b<span class="token operator">&amp;</span>c<span class="token operator">&amp;~</span>d<span class="token punctuation">)</span> <span class="token operator">|</span>  <span class="token punctuation">(</span>a<span class="token operator">&amp;</span>b<span class="token operator">&amp;</span>c<span class="token operator">&amp;~</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//硬刚</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="5-1-4-6-Minimum-SOP-and-POS"><a href="#5-1-4-6-Minimum-SOP-and-POS" class="headerlink" title="5.1.4.6 Minimum SOP and POS"></a>5.1.4.6 Minimum SOP and POS</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">input</span> a<span class="token punctuation">,</span>
    <span class="token keyword">input</span> b<span class="token punctuation">,</span>
    <span class="token keyword">input</span> c<span class="token punctuation">,</span>
    <span class="token keyword">input</span> d<span class="token punctuation">,</span>
    <span class="token keyword">output</span> out_sop<span class="token punctuation">,</span>
    <span class="token keyword">output</span> out_pos
<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token keyword">assign</span> out_pos <span class="token operator">=</span> c <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token operator">~</span>a <span class="token operator">|</span> b <span class="token operator">|</span> <span class="token operator">~</span>c<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token operator">~</span>b <span class="token operator">|</span> <span class="token operator">~</span>c <span class="token operator">|</span> d<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">assign</span> out_sop <span class="token operator">=</span> c <span class="token operator">&amp;</span> d <span class="token operator">|</span> <span class="token operator">~</span>a <span class="token operator">&amp;</span> <span class="token operator">~</span>b <span class="token operator">&amp;</span> c<span class="token punctuation">;</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>sop：sum of product 积之和</p>
<p>pos：product of sum 和之积</p>
<p>pos也可以用卡诺图处理，处理的对象变成了0，项也要相应取反。具体的证明可以使用反演定律，反演定律的证明在这篇博客里有<a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/living_frontier/article/details/120720868">计组中的组合数学_living_frontier的博客-CSDN博客</a>。</p>
<h5 id="5-1-4-7-Karnaugh-map"><a href="#5-1-4-7-Karnaugh-map" class="headerlink" title="5.1.4.7 Karnaugh map"></a>5.1.4.7 Karnaugh map</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">]</span> x<span class="token punctuation">,</span> 
    <span class="token keyword">output</span> f <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">assign</span> f <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> x<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token operator">~</span>x<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token operator">~</span>x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> x<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">//x[4:1]的下标就是4-1，不是3-0</span>
    
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="5-1-4-8-Karnaugh-map"><a href="#5-1-4-8-Karnaugh-map" class="headerlink" title="5.1.4.8 Karnaugh map"></a>5.1.4.8 Karnaugh map</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">]</span> x<span class="token punctuation">,</span>
    <span class="token keyword">output</span> f
<span class="token punctuation">)</span><span class="token punctuation">;</span> 

    <span class="token keyword">assign</span> f <span class="token operator">=</span> <span class="token operator">~</span>x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> x<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token operator">~</span>x<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token operator">~</span>x<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">|</span> x<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> x<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> x<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="5-1-4-9-K-map-implemented-with-a-multiplexer"><a href="#5-1-4-9-K-map-implemented-with-a-multiplexer" class="headerlink" title="5.1.4.9 K-map implemented with a multiplexer"></a>5.1.4.9 K-map implemented with a multiplexer</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">input</span> c<span class="token punctuation">,</span>
    <span class="token keyword">input</span> d<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> mux_in
<span class="token punctuation">)</span><span class="token punctuation">;</span> 

    <span class="token keyword">assign</span> mux_in <span class="token operator">=</span> <span class="token operator">{</span><span class="token punctuation">(</span>c<span class="token operator">&amp;</span>d<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token operator">~</span>d<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1'b0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>c<span class="token operator">|</span>d<span class="token punctuation">)</span><span class="token operator">}</span><span class="token punctuation">;</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="5-2-Sequential-Logic"><a href="#5-2-Sequential-Logic" class="headerlink" title="5.2 Sequential Logic"></a>5.2 Sequential Logic</h3><h4 id="5-2-1-Latches-and-Flip-Flops"><a href="#5-2-1-Latches-and-Flip-Flops" class="headerlink" title="5.2.1 Latches and Flip-Flops"></a>5.2.1 Latches and Flip-Flops</h4><h5 id="5-2-1-1-D-Flip-Flop"><a href="#5-2-1-1-D-Flip-Flop" class="headerlink" title="5.2.1.1 D Flip-Flop"></a>5.2.1.1 D Flip-Flop</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">input</span> clk<span class="token punctuation">,</span>    <span class="token comment">// Clocks are used in sequential circuits</span>
    <span class="token keyword">input</span> d<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token keyword">reg</span> q <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//</span>

    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span>
        q <span class="token operator">&lt;=</span> d<span class="token punctuation">;</span>
    <span class="token keyword">end</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>显然，HDLBits想让我们在always @(posedge clk)和寄存器之间建立一种联系，这是一个很好的想法。</p>
<h5 id="5-2-1-2-D-Flip-Flops"><a href="#5-2-1-2-D-Flip-Flops" class="headerlink" title="5.2.1.2 D Flip-Flops"></a>5.2.1.2 D Flip-Flops</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">input</span> clk<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> d<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> q
<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span>
        q <span class="token operator">&lt;=</span> d<span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>简单的标量变向量。</p>
<h5 id="5-2-1-3-DFF-with-reset"><a href="#5-2-1-3-DFF-with-reset" class="headerlink" title="5.2.1.3 DFF with reset"></a>5.2.1.3 DFF with reset</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">input</span> clk<span class="token punctuation">,</span>
    <span class="token keyword">input</span> reset<span class="token punctuation">,</span>            <span class="token comment">// Synchronous reset</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> d<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> q
<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span>
        <span class="token function">if</span><span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
            q <span class="token operator">&lt;=</span> <span class="token number">8'd0</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> 
            q <span class="token operator">&lt;=</span> d<span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这个题和5.2.1.5是同步复位和异步复位的标准写法，很规范而且优雅。</p>
<h5 id="5-2-1-3-DFF-with-reset-value"><a href="#5-2-1-3-DFF-with-reset-value" class="headerlink" title="5.2.1.3 DFF with reset value"></a>5.2.1.3 DFF with reset value</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">input</span> clk<span class="token punctuation">,</span>
    <span class="token keyword">input</span> reset<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> d<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> q
<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">negedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span>
        <span class="token function">if</span><span class="token punctuation">(</span>reset <span class="token operator">==</span> <span class="token number">1'd1</span><span class="token punctuation">)</span>
            q <span class="token operator">&lt;=</span> <span class="token number">8'h34</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            q <span class="token operator">&lt;=</span> d<span class="token punctuation">;</span>
    <span class="token keyword">end</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="5-2-1-4-DFF-with-asynchronous-reset"><a href="#5-2-1-4-DFF-with-asynchronous-reset" class="headerlink" title="5.2.1.4 DFF with asynchronous reset"></a>5.2.1.4 DFF with asynchronous reset</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">input</span> clk<span class="token punctuation">,</span>
    <span class="token keyword">input</span> areset<span class="token punctuation">,</span>   <span class="token comment">// active high asynchronous reset</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> d<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> q
<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">,</span> <span class="token keyword">posedge</span> areset<span class="token punctuation">)</span> <span class="token keyword">begin</span><span class="token comment">//这个需要注意一下</span>
        <span class="token function">if</span><span class="token punctuation">(</span>areset<span class="token punctuation">)</span>
            q <span class="token operator">&lt;=</span> <span class="token number">8'd0</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            q <span class="token operator">&lt;=</span> d<span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>异步复位的标准写法。</p>
<h5 id="5-2-1-5-DFF-with-byte-enable"><a href="#5-2-1-5-DFF-with-byte-enable" class="headerlink" title="5.2.1.5 DFF with byte enable"></a>5.2.1.5 DFF with byte enable</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">input</span> clk<span class="token punctuation">,</span>
    <span class="token keyword">input</span> resetn<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> byteena<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> d<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> q
<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span>
        <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">~</span>resetn<span class="token punctuation">)</span>
            q <span class="token operator">&lt;=</span> <span class="token number">16'h0</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>byteena<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">|</span> byteena<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>
            <span class="token function">if</span><span class="token punctuation">(</span>byteena<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                q<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> d<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token function">if</span><span class="token punctuation">(</span>byteena<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                q<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> d<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这是具有使能端的寄存器的标准写法。</p>
<h5 id="5-2-1-6-D-latch"><a href="#5-2-1-6-D-latch" class="headerlink" title="5.2.1.6 D-latch"></a>5.2.1.6 D-latch</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">input</span> d<span class="token punctuation">,</span> 
    <span class="token keyword">input</span> ena<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token keyword">reg</span> q<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>
        <span class="token function">if</span><span class="token punctuation">(</span>ena<span class="token punctuation">)</span>
            q <span class="token operator">=</span> d<span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可见一定要破除对锁存器的恐惧，这个代码是没有问题的。有问题的是提出这个问题却不给解答，从而让恐惧蔓延的人。</p>
<h5 id="5-2-1-7-DFF"><a href="#5-2-1-7-DFF" class="headerlink" title="5.2.1.7 DFF"></a>5.2.1.7 DFF</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">input</span> clk<span class="token punctuation">,</span>
    <span class="token keyword">input</span> d<span class="token punctuation">,</span> 
    <span class="token keyword">input</span> ar<span class="token punctuation">,</span>   <span class="token comment">// asynchronous reset</span>
    <span class="token keyword">output</span> <span class="token keyword">reg</span> q<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">,</span> <span class="token keyword">posedge</span> ar<span class="token punctuation">)</span> <span class="token keyword">begin</span>
        <span class="token function">if</span><span class="token punctuation">(</span>ar<span class="token punctuation">)</span>
            q <span class="token operator">&lt;=</span> <span class="token number">1'b0</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
			q <span class="token operator">&lt;=</span> d<span class="token punctuation">;</span>
    <span class="token keyword">end</span>
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>跟上面题目重了。</p>
<h5 id="5-2-1-8-DFF"><a href="#5-2-1-8-DFF" class="headerlink" title="5.2.1.8 DFF"></a>5.2.1.8 DFF</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">input</span> clk<span class="token punctuation">,</span>
    <span class="token keyword">input</span> d<span class="token punctuation">,</span> 
    <span class="token keyword">input</span> r<span class="token punctuation">,</span>   <span class="token comment">// synchronous reset</span>
    <span class="token keyword">output</span> <span class="token keyword">reg</span> q<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span>
        <span class="token function">if</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>
            q <span class="token operator">&lt;=</span> <span class="token number">1'b0</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            q <span class="token operator">&lt;=</span> d<span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="5-2-1-9-DFF-gate"><a href="#5-2-1-9-DFF-gate" class="headerlink" title="5.2.1.9 DFF+gate"></a>5.2.1.9 DFF+gate</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">input</span> clk<span class="token punctuation">,</span>
    <span class="token keyword">input</span> in<span class="token punctuation">,</span> 
    <span class="token keyword">output</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span>
        out <span class="token operator">&lt;=</span> in <span class="token operator">^</span> out<span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>其实按照状态机的规范写法，应该把 in^out 拆出去写，这其实就是个moore状态机。</p>
<h5 id="5-2-1-10-Mux-and-DFF"><a href="#5-2-1-10-Mux-and-DFF" class="headerlink" title="5.2.1.10 Mux and DFF"></a>5.2.1.10 Mux and DFF</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
	<span class="token keyword">input</span> clk<span class="token punctuation">,</span>
	<span class="token keyword">input</span> L<span class="token punctuation">,</span>
	<span class="token keyword">input</span> r_in<span class="token punctuation">,</span>
	<span class="token keyword">input</span> q_in<span class="token punctuation">,</span>
	<span class="token keyword">output</span> <span class="token keyword">reg</span> Q<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">wire</span> tmp<span class="token punctuation">;</span>
    <span class="token keyword">assign</span> tmp <span class="token operator">=</span> <span class="token punctuation">(</span>L <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">?</span> r_in <span class="token punctuation">:</span> q_in<span class="token punctuation">;</span>
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span>
        Q <span class="token operator">&lt;=</span> tmp<span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="5-2-1-11-Mux-and-DFF"><a href="#5-2-1-11-Mux-and-DFF" class="headerlink" title="5.2.1.11 Mux and DFF"></a>5.2.1.11 Mux and DFF</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">input</span> clk<span class="token punctuation">,</span>
    <span class="token keyword">input</span> w<span class="token punctuation">,</span> R<span class="token punctuation">,</span> E<span class="token punctuation">,</span> L<span class="token punctuation">,</span>
    <span class="token keyword">output</span> Q
<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">wire</span> tmp1<span class="token punctuation">;</span>
    <span class="token keyword">assign</span> tmp1 <span class="token operator">=</span> E <span class="token operator">?</span> w <span class="token punctuation">:</span> Q<span class="token punctuation">;</span>
    <span class="token keyword">wire</span> tmp2 <span class="token operator">=</span> L <span class="token operator">?</span> R <span class="token punctuation">:</span> tmp1<span class="token punctuation">;</span>
    
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span>
        Q <span class="token operator">&lt;=</span> tmp2<span class="token punctuation">;</span>
    <span class="token keyword">end</span>
            
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="5-2-1-12-DFF-and-gates"><a href="#5-2-1-12-DFF-and-gates" class="headerlink" title="5.2.1.12 DFF and gates"></a>5.2.1.12 DFF and gates</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">input</span> clk<span class="token punctuation">,</span>
    <span class="token keyword">input</span> x<span class="token punctuation">,</span>
    <span class="token keyword">output</span> z
<span class="token punctuation">)</span><span class="token punctuation">;</span> 

    <span class="token keyword">reg</span> q1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">reg</span> q2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">reg</span> q3 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token important">always @</span> <span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span>
        <span class="token keyword">begin</span>
            q1 <span class="token operator">&lt;=</span> x <span class="token operator">^</span> q1<span class="token punctuation">;</span> 
        <span class="token keyword">end</span>

    <span class="token important">always @</span> <span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span>
        <span class="token keyword">begin</span>
            q2 <span class="token operator">&lt;=</span> x <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token operator">~</span>q2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">end</span>

    <span class="token important">always @</span> <span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span>
        <span class="token keyword">begin</span>
            q3 <span class="token operator">&lt;=</span> x <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token operator">~</span>q3<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">end</span>

    <span class="token keyword">assign</span> z <span class="token operator">=</span> <span class="token operator">~</span><span class="token punctuation">(</span>q1 <span class="token operator">|</span> q2 <span class="token operator">|</span> q3<span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="5-2-1-13-Create-circuit-from-truth-table"><a href="#5-2-1-13-Create-circuit-from-truth-table" class="headerlink" title="5.2.1.13 Create circuit from truth table"></a>5.2.1.13 Create circuit from truth table</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">input</span> clk<span class="token punctuation">,</span>
    <span class="token keyword">input</span> j<span class="token punctuation">,</span>
    <span class="token keyword">input</span> k<span class="token punctuation">,</span>
    <span class="token keyword">output</span> Q<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span>
        <span class="token keyword">case</span> <span class="token punctuation">(</span><span class="token operator">{</span>j<span class="token punctuation">,</span> k<span class="token operator">}</span><span class="token punctuation">)</span>
            <span class="token number">2'b00</span><span class="token punctuation">:</span> Q <span class="token operator">&lt;=</span> Q<span class="token punctuation">;</span>
            <span class="token number">2'b01</span><span class="token punctuation">:</span> Q <span class="token operator">&lt;=</span> <span class="token number">1'b0</span><span class="token punctuation">;</span>
            <span class="token number">2'b10</span><span class="token punctuation">:</span> Q <span class="token operator">&lt;=</span> <span class="token number">1'b1</span><span class="token punctuation">;</span>
            <span class="token number">2'b11</span><span class="token punctuation">:</span> Q <span class="token operator">&lt;=</span> <span class="token operator">~</span>Q<span class="token punctuation">;</span>
        <span class="token keyword">endcase</span>
    <span class="token keyword">end</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这道题即使看上去是个jk触发器，其实当j = 1，k = 1的时候，不是翻转，而是反复翻转，所以这个状态时不被允许的。</p>
<h5 id="5-2-1-14-Detect-an-edge"><a href="#5-2-1-14-Detect-an-edge" class="headerlink" title="5.2.1.14 Detect an edge"></a>5.2.1.14 Detect an edge</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">input</span> clk<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> in<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> pedge
<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> in_r1<span class="token punctuation">,</span> in_r2<span class="token punctuation">;</span>
    <span class="token important">always@</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span>
        in_r1 <span class="token operator">&lt;=</span> in<span class="token punctuation">;</span>
        in_r2 <span class="token operator">&lt;=</span> in_r1<span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    <span class="token keyword">assign</span> pedge <span class="token operator">=</span> <span class="token operator">~</span>in_r2 <span class="token operator">&amp;</span> in_r1<span class="token punctuation">;</span>
    <span class="token comment">//这法子太牛逼了</span>
 
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这个方法我想不出来较为自然的理解办法，只能说太厉害了。</p>
<p>另外这道题声明了两个寄存器，来让in_r2这个寄存器获得延后in一周期的波动，其中涉及了非阻塞赋值（当然如果从寄存器角度理解，就是寄存器串联），其中的原理可以查看这篇博客<a target="_blank" rel="noopener external nofollow noreferrer" href="http://cscore.buaa.edu.cn/#/discussion_area/151/posts">http://cscore.buaa.edu.cn/#/discussion_area/151/posts</a></p>
<h5 id="5-2-1-15-Detect-both-edge"><a href="#5-2-1-15-Detect-both-edge" class="headerlink" title="5.2.1.15 Detect both edge"></a>5.2.1.15 Detect both edge</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">input</span> clk<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> in<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> anyedge
<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> in_r1<span class="token punctuation">,</span> in_r2<span class="token punctuation">;</span>
    <span class="token important">always@</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span>
        in_r1 <span class="token operator">&lt;=</span> in<span class="token punctuation">;</span>
        in_r2 <span class="token operator">&lt;=</span> in_r1<span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    <span class="token keyword">assign</span> anyedge <span class="token operator">=</span> in_r2 <span class="token operator">^</span> in_r1<span class="token punctuation">;</span>
 
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>继续跪着看答案。</p>
<h5 id="5-2-1-16-Edge-capture-regesiter"><a href="#5-2-1-16-Edge-capture-regesiter" class="headerlink" title="5.2.1.16 Edge capture regesiter"></a>5.2.1.16 Edge capture regesiter</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">input</span> clk<span class="token punctuation">,</span>
    <span class="token keyword">input</span> reset<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> in<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> out
<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>	in_reg<span class="token punctuation">;</span>
    
    <span class="token important">always@</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span><span class="token keyword">begin</span>
        in_reg <span class="token operator">&lt;=</span> in<span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    
    <span class="token important">always@</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span><span class="token keyword">begin</span>
        <span class="token function">if</span><span class="token punctuation">(</span>reset<span class="token punctuation">)</span><span class="token keyword">begin</span>
            out <span class="token operator">&lt;=</span> <span class="token number">32'd0</span><span class="token punctuation">;</span>
        <span class="token keyword">end</span>
        <span class="token keyword">else</span> <span class="token keyword">begin</span>
            out <span class="token operator">&lt;=</span> <span class="token operator">~</span>in <span class="token operator">&amp;</span> in_reg <span class="token operator">|</span> out<span class="token punctuation">;</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
    
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这个题是检测下降沿，检测到后out一直为高，直到reset == 1时，out为0。</p>
<p>方法依然难以揣摩，就记住把。</p>
<h5 id="5-2-1-17-Dual-edge-triggered-flip-flop"><a href="#5-2-1-17-Dual-edge-triggered-flip-flop" class="headerlink" title="5.2.1.17 Dual-edge triggered flip-flop"></a>5.2.1.17 Dual-edge triggered flip-flop</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">input</span> clk<span class="token punctuation">,</span>
    <span class="token keyword">input</span> d<span class="token punctuation">,</span>
    <span class="token keyword">output</span> q
<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">reg</span> p<span class="token punctuation">,</span> n<span class="token punctuation">;</span>
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> p <span class="token operator">&lt;=</span> d<span class="token punctuation">;</span>
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">negedge</span> clk<span class="token punctuation">)</span> n <span class="token operator">&lt;=</span> d<span class="token punctuation">;</span>
    <span class="token keyword">assign</span> q <span class="token operator">=</span> clk <span class="token operator">?</span> p <span class="token punctuation">:</span> n<span class="token punctuation">;</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这个方法声明了一个上升边沿敏感的寄存器，一个下降边沿敏感的寄存器，然后用clk决定输出哪一个的值。</p>
<p>但是有一个问题，就是现实世界中，因为寄存器延迟，会产生毛刺，就是寄存器还没更新，就执行了assign语句，也就是在clk由0变1的过程，q的值是 旧n，旧q，新q，而我们只想要的是旧n，新q。</p>
<p>所以就有了标答解法（上面那种是可以过测评的）</p>
<pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span>
	<span class="token keyword">input</span> clk<span class="token punctuation">,</span>
	<span class="token keyword">input</span> d<span class="token punctuation">,</span>
	<span class="token keyword">output</span> q<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">reg</span> p<span class="token punctuation">,</span> n<span class="token punctuation">;</span>
	
	<span class="token comment">// A positive-edge triggered flip-flop</span>
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span>
        p <span class="token operator">&lt;=</span> d <span class="token operator">^</span> n<span class="token punctuation">;</span>
        
    <span class="token comment">// A negative-edge triggered flip-flop</span>
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">negedge</span> clk<span class="token punctuation">)</span>
        n <span class="token operator">&lt;=</span> d <span class="token operator">^</span> p<span class="token punctuation">;</span>
    
    <span class="token comment">// Why does this work? </span>
    <span class="token comment">// After posedge clk, p changes to d^n. Thus q = (p^n) = (d^n^n) = d.</span>
    <span class="token comment">// After negedge clk, n changes to p^n. Thus q = (p^n) = (p^p^n) = d.</span>
    <span class="token comment">// At each (positive or negative) clock edge, p and n FFs alternately</span>
    <span class="token comment">// load a value that will cancel out the other and cause the new value of d to remain.</span>
    <span class="token keyword">assign</span> q <span class="token operator">=</span> p <span class="token operator">^</span> n<span class="token punctuation">;</span>
    
    
	<span class="token comment">// Can't synthesize this.</span>
	<span class="token comment">/*always @(posedge clk, negedge clk) begin
		q &lt;= d;
	end*/</span>
    
    
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这样的话，就没有毛刺了。</p>
<h4 id="5-2-2-Counters"><a href="#5-2-2-Counters" class="headerlink" title="5.2.2 Counters"></a>5.2.2 Counters</h4><h5 id="5-2-2-1-Four-bit-binary-counter"><a href="#5-2-2-1-Four-bit-binary-counter" class="headerlink" title="5.2.2.1 Four-bit binary counter"></a>5.2.2.1 Four-bit binary counter</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">input</span> clk<span class="token punctuation">,</span>
    <span class="token keyword">input</span> reset<span class="token punctuation">,</span>      <span class="token comment">// Synchronous active-high reset</span>
    <span class="token keyword">output</span> <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> q<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">initial</span> <span class="token keyword">begin</span>
        q <span class="token operator">&lt;=</span> <span class="token number">4'd0</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span>
        <span class="token function">if</span><span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
            q <span class="token operator">&lt;=</span> <span class="token number">4'd0</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            q <span class="token operator">&lt;=</span> q <span class="token operator">+</span> <span class="token number">4'd1</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="5-2-2-2-Decade-counter"><a href="#5-2-2-2-Decade-counter" class="headerlink" title="5.2.2.2 Decade counter"></a>5.2.2.2 Decade counter</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">input</span> clk<span class="token punctuation">,</span>
    <span class="token keyword">input</span> reset<span class="token punctuation">,</span>        <span class="token comment">// Synchronous active-high reset</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> q<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span>
        <span class="token function">if</span><span class="token punctuation">(</span>reset <span class="token operator">||</span> q <span class="token operator">&gt;=</span> <span class="token number">9</span><span class="token punctuation">)</span>
            q <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> 
            q <span class="token operator">&lt;=</span> q <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这个通过修改复位信号，来达到模n计数器的方法，也就是所谓的<strong>反馈复位法</strong>。</p>
<h5 id="5-2-2-3-Decade-counter-again"><a href="#5-2-2-3-Decade-counter-again" class="headerlink" title="5.2.2.3 Decade counter again"></a>5.2.2.3 Decade counter again</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">input</span> clk<span class="token punctuation">,</span>
    <span class="token keyword">input</span> reset<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> q<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span>
        <span class="token function">if</span><span class="token punctuation">(</span>reset <span class="token operator">||</span> q <span class="token operator">&gt;=</span> <span class="token number">4'd10</span><span class="token punctuation">)</span>
            q <span class="token operator">&lt;=</span> <span class="token number">4'd1</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            q <span class="token operator">&lt;=</span> q <span class="token operator">+</span> <span class="token number">4'd1</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="5-2-2-4-Slow-decade-counter"><a href="#5-2-2-4-Slow-decade-counter" class="headerlink" title="5.2.2.4 Slow decade counter"></a>5.2.2.4 Slow decade counter</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">input</span> clk<span class="token punctuation">,</span>
    <span class="token keyword">input</span> slowena<span class="token punctuation">,</span>
    <span class="token keyword">input</span> reset<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> q<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> cnt<span class="token punctuation">,</span> nextCnt<span class="token punctuation">;</span>
    
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span>
        <span class="token function">if</span><span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
            cnt <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            cnt <span class="token operator">&lt;=</span> nextCnt<span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>
        <span class="token function">if</span><span class="token punctuation">(</span>slowena<span class="token punctuation">)</span> <span class="token keyword">begin</span>
            <span class="token function">if</span><span class="token punctuation">(</span>cnt <span class="token operator">==</span> <span class="token number">9</span><span class="token punctuation">)</span>
                nextCnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span>
                nextCnt <span class="token operator">=</span> cnt <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">end</span>
        <span class="token keyword">else</span>
           nextCnt <span class="token operator">=</span> cnt<span class="token punctuation">;</span> 
    <span class="token keyword">end</span>
    
    <span class="token keyword">assign</span> q <span class="token operator">=</span> cnt<span class="token punctuation">;</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>带有使能端的计数器的标准写法。</p>
<h5 id="5-2-2-5-Counter-1-12"><a href="#5-2-2-5-Counter-1-12" class="headerlink" title="5.2.2.5 Counter 1-12"></a>5.2.2.5 Counter 1-12</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">input</span> clk<span class="token punctuation">,</span>
    <span class="token keyword">input</span> reset<span class="token punctuation">,</span>
    <span class="token keyword">input</span> enable<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> Q<span class="token punctuation">,</span>
    <span class="token keyword">output</span> c_enable<span class="token punctuation">,</span>
    <span class="token keyword">output</span> c_load<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> c_d
<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//</span>

    count4 the_counter <span class="token punctuation">(</span>clk<span class="token punctuation">,</span> c_enable<span class="token punctuation">,</span> c_load<span class="token punctuation">,</span> c_d<span class="token punctuation">,</span> Q<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> c_enable <span class="token operator">=</span> enable<span class="token punctuation">;</span>
    <span class="token keyword">assign</span> c_load <span class="token operator">=</span> reset <span class="token operator">||</span> Q <span class="token operator">==</span> <span class="token number">4'd12</span> <span class="token operator">&amp;&amp;</span> enable <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> c_d <span class="token operator">=</span> c_load<span class="token operator">?</span> <span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这道题没看懂。</p>
<h5 id="5-2-2-6-Counter-1000"><a href="#5-2-2-6-Counter-1000" class="headerlink" title="5.2.2.6 Counter 1000"></a>5.2.2.6 Counter 1000</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">input</span> clk<span class="token punctuation">,</span>
    <span class="token keyword">input</span> reset<span class="token punctuation">,</span>
    <span class="token keyword">output</span> OneHertz<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> c_enable
<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//</span>

    <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> q0<span class="token punctuation">,</span> q1<span class="token punctuation">,</span> q2<span class="token punctuation">;</span>
    
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>
        <span class="token function">if</span><span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
            c_enable <span class="token operator">=</span> <span class="token number">3'b001</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">begin</span>
            <span class="token function">if</span><span class="token punctuation">(</span>q1 <span class="token operator">==</span> <span class="token number">4'd9</span> <span class="token operator">&amp;&amp;</span> q0 <span class="token operator">==</span> <span class="token number">4'd9</span><span class="token punctuation">)</span>
                c_enable <span class="token operator">=</span> <span class="token number">3'b111</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>q0 <span class="token operator">==</span> <span class="token number">4'd9</span><span class="token punctuation">)</span>
                c_enable <span class="token operator">=</span> <span class="token number">3'b011</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span>
                c_enable <span class="token operator">=</span> <span class="token number">3'b001</span><span class="token punctuation">;</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
    
    <span class="token keyword">assign</span> OneHertz <span class="token operator">=</span> <span class="token punctuation">(</span>q2<span class="token operator">==</span><span class="token number">4'd9</span> <span class="token operator">&amp;&amp;</span> q1<span class="token operator">==</span><span class="token number">4'd9</span> <span class="token operator">&amp;&amp;</span> q0<span class="token operator">==</span><span class="token number">4'd9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    bcdcount counter0 <span class="token punctuation">(</span>clk<span class="token punctuation">,</span> reset<span class="token punctuation">,</span> c_enable<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> q0<span class="token punctuation">)</span><span class="token punctuation">;</span>
    bcdcount counter1 <span class="token punctuation">(</span>clk<span class="token punctuation">,</span> reset<span class="token punctuation">,</span> c_enable<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> q1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    bcdcount counter2 <span class="token punctuation">(</span>clk<span class="token punctuation">,</span> reset<span class="token punctuation">,</span> c_enable<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> q2<span class="token punctuation">)</span><span class="token punctuation">;</span>    

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这道题是一个用三个十计数器拼成一个千计数器的例子，还是非常厉害的，用不同的控制信号c_enable，来使三个计数器处于工作或者停止的状态，符合十进制进位。而且还别5.2.2.8简单。</p>
<h5 id="5-2-2-7-4-digit-decimal-counter"><a href="#5-2-2-7-4-digit-decimal-counter" class="headerlink" title="5.2.2.7 4-digit decimal counter"></a>5.2.2.7 4-digit decimal counter</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">input</span> clk<span class="token punctuation">,</span>
    <span class="token keyword">input</span> reset<span class="token punctuation">,</span>   <span class="token comment">// Synchronous active-high reset</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">]</span> ena<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> q<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//这里用到了循环生成语句，值得一写，好吧，没法用</span>
    BCDCounter <span class="token function">cnt0</span><span class="token punctuation">(</span>clk<span class="token punctuation">,</span> reset<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> q<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    BCDCounter <span class="token function">cnt1</span><span class="token punctuation">(</span>clk<span class="token punctuation">,</span> reset<span class="token punctuation">,</span> q<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">9</span><span class="token punctuation">,</span> q<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    BCDCounter <span class="token function">cnt2</span><span class="token punctuation">(</span>clk<span class="token punctuation">,</span> reset<span class="token punctuation">,</span> q<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">9</span> <span class="token operator">&amp;&amp;</span> q<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">9</span><span class="token punctuation">,</span> q<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    BCDCounter <span class="token function">cnt3</span><span class="token punctuation">(</span>clk<span class="token punctuation">,</span> reset<span class="token punctuation">,</span> q<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">9</span> <span class="token operator">&amp;&amp;</span> q<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">9</span> <span class="token operator">&amp;&amp;</span> q<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">9</span><span class="token punctuation">,</span> q<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">assign</span> ena <span class="token operator">=</span> <span class="token operator">{</span>q<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">9</span> <span class="token operator">&amp;&amp;</span> q<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">9</span> <span class="token operator">&amp;&amp;</span> q<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">9</span><span class="token punctuation">,</span> q<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">9</span> <span class="token operator">&amp;&amp;</span> q<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">9</span><span class="token punctuation">,</span> q<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">9</span><span class="token operator">}</span><span class="token punctuation">;</span>
    
<span class="token keyword">endmodule</span>

<span class="token keyword">module</span> BCDCounter <span class="token punctuation">(</span>
    <span class="token keyword">input</span> clk<span class="token punctuation">,</span>
    <span class="token keyword">input</span> reset<span class="token punctuation">,</span>        <span class="token comment">// Synchronous active-high reset</span>
    <span class="token keyword">input</span> ena<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> q<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
    <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> nextQ<span class="token punctuation">;</span>
    
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>
        <span class="token function">if</span><span class="token punctuation">(</span>q <span class="token operator">==</span> <span class="token number">9</span><span class="token punctuation">)</span>
            nextQ <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            nextQ <span class="token operator">=</span> q <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span>
        <span class="token function">if</span><span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
            q <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>ena<span class="token punctuation">)</span> 
            q <span class="token operator">&lt;=</span> nextQ<span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>一个BCD的计数器，还是在ena端做文章，只有在达到某些条件的情况下，才能ena。</p>
<h5 id="5-2-2-8-12-hour-clock"><a href="#5-2-2-8-12-hour-clock" class="headerlink" title="5.2.2.8 12-hour clock"></a>5.2.2.8 12-hour clock</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span>
    <span class="token keyword">input</span> clk<span class="token punctuation">,</span>
    <span class="token keyword">input</span> reset<span class="token punctuation">,</span>
    <span class="token keyword">input</span> ena<span class="token punctuation">,</span>
    <span class="token keyword">output</span> pm<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> hh<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> mm<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> ss<span class="token punctuation">)</span><span class="token punctuation">;</span> 
	<span class="token comment">//要讲一下严谨的问题，还要讲模块wire输出的问题，还有仿真操作</span>
    <span class="token keyword">wire</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> m_ten<span class="token punctuation">,</span> m_one<span class="token punctuation">,</span> s_ten<span class="token punctuation">,</span> s_one<span class="token punctuation">;</span>
    <span class="token keyword">assign</span> ss <span class="token operator">=</span> <span class="token operator">{</span>s_ten<span class="token punctuation">,</span> s_one<span class="token operator">}</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> mm <span class="token operator">=</span> <span class="token operator">{</span>m_ten<span class="token punctuation">,</span> m_one<span class="token operator">}</span><span class="token punctuation">;</span>
    
    BCDCounter <span class="token function">ss_low</span><span class="token punctuation">(</span>clk<span class="token punctuation">,</span> reset<span class="token punctuation">,</span> ena<span class="token punctuation">,</span> s_one<span class="token punctuation">)</span><span class="token punctuation">;</span>
    BCDCounter <span class="token function">ss_high</span><span class="token punctuation">(</span>clk<span class="token punctuation">,</span> reset <span class="token operator">||</span> ss <span class="token operator">==</span> <span class="token number">8'h59</span><span class="token punctuation">,</span> s_one <span class="token operator">==</span> <span class="token number">4'h9</span> <span class="token operator">&amp;&amp;</span> ena<span class="token punctuation">,</span> s_ten<span class="token punctuation">)</span><span class="token punctuation">;</span>
    BCDCounter <span class="token function">mm_low</span><span class="token punctuation">(</span>clk<span class="token punctuation">,</span> reset<span class="token punctuation">,</span> ss <span class="token operator">==</span> <span class="token number">8'h59</span> <span class="token operator">&amp;&amp;</span> ena<span class="token punctuation">,</span> m_one<span class="token punctuation">)</span><span class="token punctuation">;</span>
    BCDCounter <span class="token function">mm_high</span><span class="token punctuation">(</span>clk<span class="token punctuation">,</span> reset <span class="token operator">||</span> mm <span class="token operator">==</span> <span class="token number">8'h59</span> <span class="token operator">&amp;&amp;</span> ss <span class="token operator">==</span> <span class="token number">8'h59</span><span class="token punctuation">,</span> m_one <span class="token operator">==</span> <span class="token number">4'h9</span> <span class="token operator">&amp;&amp;</span> ss <span class="token operator">==</span> <span class="token number">8'h59</span> <span class="token operator">&amp;&amp;</span> ena<span class="token punctuation">,</span> m_ten<span class="token punctuation">)</span><span class="token punctuation">;</span>
   
    <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> nextHh<span class="token punctuation">;</span>
    
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> 
	<span class="token keyword">begin</span>
        <span class="token function">if</span><span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
            hh <span class="token operator">&lt;=</span> <span class="token number">8'h12</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            hh <span class="token operator">&lt;=</span> nextHh<span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>
    <span class="token keyword">begin</span>
        <span class="token function">if</span><span class="token punctuation">(</span>ena <span class="token operator">&amp;&amp;</span> mm <span class="token operator">==</span> <span class="token number">8'h59</span> <span class="token operator">&amp;&amp;</span> ss <span class="token operator">==</span> <span class="token number">8'h59</span><span class="token punctuation">)</span>
        <span class="token keyword">begin</span>
            <span class="token function">if</span><span class="token punctuation">(</span>hh <span class="token operator">==</span> <span class="token number">8'h09</span><span class="token punctuation">)</span>
                nextHh <span class="token operator">=</span> <span class="token number">8'h10</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>hh <span class="token operator">==</span> <span class="token number">8'h10</span><span class="token punctuation">)</span>
                nextHh <span class="token operator">=</span> <span class="token number">8'h11</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>hh <span class="token operator">==</span> <span class="token number">8'h11</span><span class="token punctuation">)</span>
                nextHh <span class="token operator">=</span> <span class="token number">8'h12</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>hh <span class="token operator">==</span> <span class="token number">8'h12</span><span class="token punctuation">)</span>
                nextHh <span class="token operator">=</span> <span class="token number">8'h01</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span>
                nextHh <span class="token operator">=</span> hh <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">end</span>
        <span class="token keyword">else</span>
            nextHh <span class="token operator">=</span> hh<span class="token punctuation">;</span>      
    <span class="token keyword">end</span>
    
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token punctuation">)</span> 
    <span class="token keyword">begin</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>reset<span class="token punctuation">)</span> 
            pm <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    	<span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>hh <span class="token operator">==</span>  <span class="token number">8'h11</span> <span class="token operator">&amp;&amp;</span> mm <span class="token operator">==</span> <span class="token number">8'h59</span> <span class="token operator">&amp;&amp;</span> ss <span class="token operator">==</span> <span class="token number">8'h59</span><span class="token punctuation">)</span>
        	pm <span class="token operator">=</span> <span class="token operator">~</span>pm<span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    
<span class="token keyword">endmodule</span>

<span class="token keyword">module</span> BCDCounter <span class="token punctuation">(</span>
    <span class="token keyword">input</span> clk<span class="token punctuation">,</span>
    <span class="token keyword">input</span> reset<span class="token punctuation">,</span>       
    <span class="token keyword">input</span> ena<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> q<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
    <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> nextQ<span class="token punctuation">;</span>
    
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>
        <span class="token function">if</span><span class="token punctuation">(</span>q <span class="token operator">==</span> <span class="token number">9</span><span class="token punctuation">)</span>
            nextQ <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            nextQ <span class="token operator">=</span> q <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span>
        <span class="token function">if</span><span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
            q <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>ena<span class="token punctuation">)</span> 
            q <span class="token operator">&lt;=</span> nextQ<span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这道题的思路是用十进制计数器模拟出模6和模10计数器，可以用反馈复位法获得模6计数器，但是模12计数器是没有办法获得的，所以需要另外写一个（其实也可以，但是进位进制和反馈机制过于复杂，而且赋初值的操作除非增设端口，不然也不容易实现）。</p>
<p>这道题还需要模块的输出端口连接的必须是wire类型，如果是reg类型，会出现x值，但是在HDLBits中不容易发现，因为它不会报错，也能通过测评。</p>
<p>这是一个使能端有效时才计数的钟表，不能认为ena信号只需要传入到秒针的个位，而是应该传到每一位，不然在59s时候，就是没有ena，前面的分针和时针依然会计数，这就与设计不符了。</p>
<p>此外，在这道题中为了模拟的好，需要更多周期的模拟，在这里系统介绍一下模拟的时间调整方法：<br>timescale的格式如下</p>
<pre class="line-numbers language-none"><code class="language-none">`timescale 1ns / 1ps<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>其中前一个代表<strong>时间单元</strong>是1ns，而后面代表<strong>时间精度</strong>是1ps。需要多一句嘴的是，这里的数值只能是1、10、100，而且时间单元必须大于等于时间精度。我们常用的是前面的<strong>时间单元</strong>，比如我们说#5，指的就是延时五个时间单元，在这个指令下就是延时5ns。</p>
<p>我们可以通过修改时间单位的值来达到增加仿真总周期的目的，比如我写了一个时钟，一个周期走一秒，默认时只能运行1分多钟，如图</p>
<p><img src="/posts/fc8b68d4/image-20211026194446947-16423204939202.png" alt="image-20211026194446947"></p>
<p>但是如果我把时间单位修改为1ps，就会发现运行了三个多小时：</p>
<p><img src="/posts/fc8b68d4/image-20211026194746201-16423204974793.png" alt="image-20211026194746201"></p>
<p>这是因为模拟时间是固定的，单位小的话，周期就多了。但是这个方法不是正途，正确的解决办法是修改这个参数</p>
<p><img src="/posts/fc8b68d4/image-20211026195222334-16423205016684.png" alt="image-20211026195222334"></p>
<p>然后就可以多仿真几个周期了，像这个我扩大了两倍，可以看到运行了七个多小时</p>
<p><img src="/posts/fc8b68d4/image-20211026195329255-16423205047345.png" alt="image-20211026195329255"></p>
<h4 id="5-2-3-Shifter-Register"><a href="#5-2-3-Shifter-Register" class="headerlink" title="5.2.3 Shifter Register"></a>5.2.3 Shifter Register</h4><h5 id="5-2-3-1-4-bit-shift-register"><a href="#5-2-3-1-4-bit-shift-register" class="headerlink" title="5.2.3.1 4-bit shift register"></a>5.2.3.1 4-bit shift register</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span>
    <span class="token keyword">input</span> clk<span class="token punctuation">,</span>
    <span class="token keyword">input</span> areset<span class="token punctuation">,</span>  <span class="token comment">// async active-high reset to zero</span>
    <span class="token keyword">input</span> load<span class="token punctuation">,</span>
    <span class="token keyword">input</span> ena<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> data<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> q<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    
    <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> nextQ<span class="token punctuation">;</span>
    
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">,</span> <span class="token keyword">posedge</span> areset<span class="token punctuation">)</span><span class="token keyword">begin</span>
        <span class="token function">if</span><span class="token punctuation">(</span>areset<span class="token punctuation">)</span>
            q <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            q <span class="token operator">&lt;=</span> nextQ<span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>
        <span class="token function">if</span><span class="token punctuation">(</span>load<span class="token punctuation">)</span>
            nextQ <span class="token operator">=</span> data<span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>ena<span class="token punctuation">)</span>
            nextQ <span class="token operator">=</span> <span class="token operator">{</span><span class="token number">1'b0</span><span class="token punctuation">,</span> q<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">}</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            nextQ <span class="token operator">=</span> q<span class="token punctuation">;</span>
    <span class="token keyword">end</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这是一个逻辑右移寄存器。</p>
<h5 id="5-2-3-2-Left-right-rotator"><a href="#5-2-3-2-Left-right-rotator" class="headerlink" title="5.2.3.2 Left/right rotator"></a>5.2.3.2 Left/right rotator</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span>
    <span class="token keyword">input</span> clk<span class="token punctuation">,</span>
    <span class="token keyword">input</span> load<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> ena<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">99</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> data<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">99</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> q<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    
    <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">99</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> nextQ<span class="token punctuation">;</span>
    
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span>
        q <span class="token operator">&lt;=</span> nextQ<span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>
        <span class="token function">if</span><span class="token punctuation">(</span>load<span class="token punctuation">)</span>
            nextQ <span class="token operator">=</span> data<span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>ena <span class="token operator">==</span> <span class="token number">2'b01</span><span class="token punctuation">)</span>
            nextQ <span class="token operator">=</span> <span class="token operator">{</span>q<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> q<span class="token punctuation">[</span><span class="token number">99</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">}</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>ena <span class="token operator">==</span> <span class="token number">2'b10</span><span class="token punctuation">)</span>
            nextQ <span class="token operator">=</span> <span class="token operator">{</span>q<span class="token punctuation">[</span><span class="token number">98</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> q<span class="token punctuation">[</span><span class="token number">99</span><span class="token punctuation">]</span><span class="token operator">}</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            nextQ <span class="token operator">=</span> q<span class="token punctuation">;</span>
    <span class="token keyword">end</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="5-2-3-3-Left-right-arithmetic-shift-by-1-or-8"><a href="#5-2-3-3-Left-right-arithmetic-shift-by-1-or-8" class="headerlink" title="5.2.3.3 Left/right arithmetic shift by 1 or 8"></a>5.2.3.3 Left/right arithmetic shift by 1 or 8</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span>
    <span class="token keyword">input</span> clk<span class="token punctuation">,</span>
    <span class="token keyword">input</span> load<span class="token punctuation">,</span>
    <span class="token keyword">input</span> ena<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> amount<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">63</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> data<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">63</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> q<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    
    <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">63</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> nextQ<span class="token punctuation">;</span>
    
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span>
    	q <span class="token operator">&lt;=</span> nextQ<span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>
        <span class="token function">if</span><span class="token punctuation">(</span>load<span class="token punctuation">)</span>
            nextQ <span class="token operator">=</span> data<span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>ena<span class="token punctuation">)</span> <span class="token keyword">begin</span>
            <span class="token function">case</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span>
            	<span class="token number">2'b00</span><span class="token punctuation">:</span>
                    nextQ <span class="token operator">=</span> <span class="token operator">{</span>q<span class="token punctuation">[</span><span class="token number">62</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1'b0</span><span class="token operator">}</span><span class="token punctuation">;</span>
                <span class="token number">2'b01</span><span class="token punctuation">:</span>
                    nextQ <span class="token operator">=</span> <span class="token operator">{</span>q<span class="token punctuation">[</span><span class="token number">55</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">8'h0</span><span class="token operator">}</span><span class="token punctuation">;</span>
                <span class="token number">2'b10</span><span class="token punctuation">:</span>
                    nextQ <span class="token operator">=</span> <span class="token operator">{</span>q<span class="token punctuation">[</span><span class="token number">63</span><span class="token punctuation">]</span><span class="token punctuation">,</span> q<span class="token punctuation">[</span><span class="token number">63</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">}</span><span class="token punctuation">;</span>
                <span class="token number">2'b11</span><span class="token punctuation">:</span>
                    nextQ <span class="token operator">=</span> <span class="token operator">{{</span><span class="token number">8</span><span class="token operator">{</span>q<span class="token punctuation">[</span><span class="token number">63</span><span class="token punctuation">]</span><span class="token operator">}}</span><span class="token punctuation">,</span> q<span class="token punctuation">[</span><span class="token number">63</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token operator">}</span><span class="token punctuation">;</span>
            <span class="token keyword">endcase</span>
        <span class="token keyword">end</span>
        <span class="token keyword">else</span>
            nextQ <span class="token operator">=</span> q<span class="token punctuation">;</span>
    <span class="token keyword">end</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>算数右移的实质就是在右端复制符号位，有数学知识如下：</p>
<p>对于算数移位，<strong>算数左移</strong>与<strong>逻辑左移</strong>相同，但是<strong>算数右移</strong>对于左侧空出的位，补得是与<strong>最左位</strong>相同的值，比如 -5 的二进制编码是 1011，那么左移一位完了就是1101, 3的二进制编码是 0011， 那么右移完了就是 0001 ，为什么会这么设置呢？是因为这样是符合<strong>算数</strong>规律的，比如 1101 （补码）的十进制就是 -3，刚好是 -5/2 = -2.5 向下取整的结果，这是为什么呢，我们只证明<strong>右移一位</strong>的情况，然后用<strong>数学归纳法</strong>来证明右移多位的情形，对于一个四位的负数，比如他是 abcd（二进制补码），那么它其实就是</p>
<script type="math/tex; mode=display">
-a\cdot 2^3 +b\cdot 2^2 + c\cdot 2^1 + d\cdot 2^0</script><p>当进行完移位以后，就是</p>
<script type="math/tex; mode=display">
-a\cdot 2^3 +a\cdot 2^2 + b\cdot 2^1 + c\cdot 2^0 = -a\cdot 2^2 + b\cdot 2^1 + c\cdot 2^0</script><p>当直接在十进制下除以2（整数除法），得到的结果是这样的</p>
<script type="math/tex; mode=display">
(-a\cdot 2^3 +b\cdot 2^2 + c\cdot 2^1 + d\cdot 2^0)/2 = -a\cdot 2^2 + b\cdot 2^1 + c\cdot 2^0</script><p>两者刚好相同。</p>
<h5 id="5-2-3-4-5-bitLFSR"><a href="#5-2-3-4-5-bitLFSR" class="headerlink" title="5.2.3.4 5-bitLFSR"></a>5.2.3.4 5-bitLFSR</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span>
    <span class="token keyword">input</span> clk<span class="token punctuation">,</span>
    <span class="token keyword">input</span> reset<span class="token punctuation">,</span>    <span class="token comment">// Active-high synchronous reset to 5'h1</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> q
<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> nextQ<span class="token punctuation">;</span>
    
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span>
        <span class="token function">if</span><span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
       		q <span class="token operator">&lt;=</span> <span class="token number">5'h1</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            q <span class="token operator">&lt;=</span> nextQ<span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>
        nextQ <span class="token operator">=</span> <span class="token operator">{</span>q<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">^</span> <span class="token number">1'b0</span><span class="token punctuation">,</span> q<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> q<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">^</span> q<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> q<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> q<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">}</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>电路实现起来是很简单的，但是可以补充一下关于线性反馈移位寄存器（LFSR）的知识。</p>
<p>LFSR常在数字电路中产生伪随机数，寄存器的初始值叫做种子，种子应该是非零的，但是伪随机数是有周期的，不奇怪，因为寄存器的位数是定值。</p>
<h5 id="5-2-3-5-3-bitLFSR"><a href="#5-2-3-5-3-bitLFSR" class="headerlink" title="5.2.3.5 3-bitLFSR"></a>5.2.3.5 3-bitLFSR</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
	<span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> SW<span class="token punctuation">,</span>      <span class="token comment">// R</span>
	<span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> KEY<span class="token punctuation">,</span>     <span class="token comment">// L and clk</span>
	<span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> LEDR<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Q</span>

	<span class="token keyword">wire</span> clk<span class="token punctuation">,</span> L<span class="token punctuation">;</span>
    <span class="token keyword">wire</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> R<span class="token punctuation">;</span>
    <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> q<span class="token punctuation">,</span> nextQ<span class="token punctuation">;</span>
    
    <span class="token keyword">assign</span> clk <span class="token operator">=</span> KEY<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> L <span class="token operator">=</span> KEY<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> R <span class="token operator">=</span> SW<span class="token punctuation">;</span>
    <span class="token keyword">assign</span> LEDR <span class="token operator">=</span> q<span class="token punctuation">;</span>
    
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span>
    	q <span class="token operator">&lt;=</span> nextQ<span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>
        <span class="token function">if</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span>
            nextQ <span class="token operator">=</span> R<span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            nextQ <span class="token operator">=</span> <span class="token operator">{</span>q<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">^</span> q<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> q<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> q<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">}</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    
    
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="5-2-3-6-32-bitLFSR"><a href="#5-2-3-6-32-bitLFSR" class="headerlink" title="5.2.3.6 32-bitLFSR"></a>5.2.3.6 32-bitLFSR</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span>
    <span class="token keyword">input</span> clk<span class="token punctuation">,</span>
    <span class="token keyword">input</span> reset<span class="token punctuation">,</span>    <span class="token comment">// Active-high synchronous reset to 32'h1</span>
    <span class="token keyword">output</span> <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> q
<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> nextQ<span class="token punctuation">;</span>
    
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span>
        <span class="token function">if</span><span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
            q <span class="token operator">&lt;=</span> <span class="token number">32'h1</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            q <span class="token operator">&lt;=</span> nextQ<span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    
    <span class="token comment">//这种赋值方式可以借鉴</span>
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>
        nextQ <span class="token operator">=</span> <span class="token operator">{</span>q<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> q<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">}</span><span class="token punctuation">;</span>
        nextQ<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1'b0</span> <span class="token operator">^</span> q<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        nextQ<span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">]</span> <span class="token operator">=</span> q<span class="token punctuation">[</span><span class="token number">22</span><span class="token punctuation">]</span> <span class="token operator">^</span> q<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        nextQ<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> q<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">^</span> q<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        nextQ<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> q<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">^</span> q<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这种做法还是很值得学习的，有的时候，我们可能一步没法达到目标（或者说达到目标过于繁琐），不如先达到一个差不多的目标，再对细节做调整。</p>
<h5 id="5-2-3-7-shift-register"><a href="#5-2-3-7-shift-register" class="headerlink" title="5.2.3.7 shift register"></a>5.2.3.7 shift register</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">input</span> clk<span class="token punctuation">,</span>
    <span class="token keyword">input</span> resetn<span class="token punctuation">,</span>   <span class="token comment">// synchronous reset</span>
    <span class="token keyword">input</span> in<span class="token punctuation">,</span>
    <span class="token keyword">output</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> q<span class="token punctuation">,</span> nextQ<span class="token punctuation">;</span>
    
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span>
        <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">~</span>resetn<span class="token punctuation">)</span>
            q <span class="token operator">&lt;=</span> <span class="token number">4'd0</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            q <span class="token operator">&lt;=</span> nextQ<span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>
        nextQ <span class="token operator">=</span> <span class="token operator">{</span>in<span class="token punctuation">,</span> q<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">}</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    
    <span class="token keyword">assign</span> out <span class="token operator">=</span> q<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>移位寄存器的标准写法。</p>
<h5 id="5-2-3-8-shift-register"><a href="#5-2-3-8-shift-register" class="headerlink" title="5.2.3.8 shift register"></a>5.2.3.8 shift register</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> SW<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> KEY<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> LEDR
<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//</span>
    <span class="token keyword">reg</span> q1<span class="token punctuation">,</span>q2<span class="token punctuation">,</span>q3<span class="token punctuation">,</span>q4<span class="token punctuation">;</span>
    MUXDFF <span class="token function">n4</span><span class="token punctuation">(</span>
        <span class="token punctuation">.</span><span class="token function">clk</span><span class="token punctuation">(</span>KEY<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">.</span><span class="token function">ain</span><span class="token punctuation">(</span>KEY<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">.</span><span class="token function">bin</span><span class="token punctuation">(</span>LEDR<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">.</span><span class="token function">cin</span><span class="token punctuation">(</span>SW<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">.</span><span class="token function">sel1</span><span class="token punctuation">(</span>KEY<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">.</span><span class="token function">sel2</span><span class="token punctuation">(</span>KEY<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">.</span><span class="token function">dout</span><span class="token punctuation">(</span>q4<span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    MUXDFF <span class="token function">n3</span><span class="token punctuation">(</span>
        <span class="token punctuation">.</span><span class="token function">clk</span><span class="token punctuation">(</span>KEY<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">.</span><span class="token function">ain</span><span class="token punctuation">(</span>q4<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">.</span><span class="token function">bin</span><span class="token punctuation">(</span>LEDR<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">.</span><span class="token function">cin</span><span class="token punctuation">(</span>SW<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">.</span><span class="token function">sel1</span><span class="token punctuation">(</span>KEY<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">.</span><span class="token function">sel2</span><span class="token punctuation">(</span>KEY<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">.</span><span class="token function">dout</span><span class="token punctuation">(</span>q3<span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    MUXDFF <span class="token function">n2</span><span class="token punctuation">(</span>
        <span class="token punctuation">.</span><span class="token function">clk</span><span class="token punctuation">(</span>KEY<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">.</span><span class="token function">ain</span><span class="token punctuation">(</span>q3<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">.</span><span class="token function">bin</span><span class="token punctuation">(</span>LEDR<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">.</span><span class="token function">cin</span><span class="token punctuation">(</span>SW<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">.</span><span class="token function">sel1</span><span class="token punctuation">(</span>KEY<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">.</span><span class="token function">sel2</span><span class="token punctuation">(</span>KEY<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">.</span><span class="token function">dout</span><span class="token punctuation">(</span>q2<span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    MUXDFF <span class="token function">n1</span><span class="token punctuation">(</span>
        <span class="token punctuation">.</span><span class="token function">clk</span><span class="token punctuation">(</span>KEY<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">.</span><span class="token function">ain</span><span class="token punctuation">(</span>q2<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">.</span><span class="token function">bin</span><span class="token punctuation">(</span>LEDR<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">.</span><span class="token function">cin</span><span class="token punctuation">(</span>SW<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">.</span><span class="token function">sel1</span><span class="token punctuation">(</span>KEY<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">.</span><span class="token function">sel2</span><span class="token punctuation">(</span>KEY<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">.</span><span class="token function">dout</span><span class="token punctuation">(</span>q1<span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> LEDR <span class="token operator">=</span> <span class="token operator">{</span>q4<span class="token punctuation">,</span>q3<span class="token punctuation">,</span>q2<span class="token punctuation">,</span>q1<span class="token operator">}</span><span class="token punctuation">;</span>
        
<span class="token keyword">endmodule</span>

<span class="token keyword">module</span> MUXDFF <span class="token punctuation">(</span>
    <span class="token keyword">input</span> clk<span class="token punctuation">,</span>
	<span class="token keyword">input</span> ain<span class="token punctuation">,</span>
	<span class="token keyword">input</span> bin<span class="token punctuation">,</span>
	<span class="token keyword">input</span> cin<span class="token punctuation">,</span>
	<span class="token keyword">input</span> sel1<span class="token punctuation">,</span>
	<span class="token keyword">input</span> sel2<span class="token punctuation">,</span>
	<span class="token keyword">output</span> dout<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token important">always @</span> <span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span>
        <span class="token keyword">begin</span>
             dout <span class="token operator">&lt;=</span> sel2<span class="token operator">?</span> cin<span class="token punctuation">:</span>
        		sel1<span class="token operator">?</span> ain<span class="token punctuation">:</span>bin<span class="token punctuation">;</span>
        <span class="token keyword">end</span>
    
    
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="3-input-LUT"><a href="#3-input-LUT" class="headerlink" title="3-input LUT"></a>3-input LUT</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span>
    <span class="token keyword">input</span> clk<span class="token punctuation">,</span>
    <span class="token keyword">input</span> enable<span class="token punctuation">,</span>
    <span class="token keyword">input</span> S<span class="token punctuation">,</span>
    <span class="token keyword">input</span> A<span class="token punctuation">,</span> B<span class="token punctuation">,</span> C<span class="token punctuation">,</span>
    <span class="token keyword">output</span> Z <span class="token punctuation">)</span><span class="token punctuation">;</span> 
    
    <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> q<span class="token punctuation">;</span>
    
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>
        <span class="token function">case</span><span class="token punctuation">(</span><span class="token operator">{</span>A<span class="token punctuation">,</span> B<span class="token punctuation">,</span> C<span class="token operator">}</span><span class="token punctuation">)</span>
            <span class="token number">0</span><span class="token punctuation">:</span>
                Z <span class="token operator">=</span> q<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token number">1</span><span class="token punctuation">:</span>
                Z <span class="token operator">=</span> q<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token number">2</span><span class="token punctuation">:</span>
                Z <span class="token operator">=</span> q<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token number">3</span><span class="token punctuation">:</span>
                Z <span class="token operator">=</span> q<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token number">4</span><span class="token punctuation">:</span>
                Z <span class="token operator">=</span> q<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token number">5</span><span class="token punctuation">:</span>
                Z <span class="token operator">=</span> q<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token number">6</span><span class="token punctuation">:</span>
                Z <span class="token operator">=</span> q<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token number">7</span><span class="token punctuation">:</span>
                Z <span class="token operator">=</span> q<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">endcase</span>
    <span class="token keyword">end</span>
    
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span>
        <span class="token function">if</span><span class="token punctuation">(</span>enable<span class="token punctuation">)</span>
            q<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token operator">{</span>q<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> S<span class="token operator">}</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>LUT是look-up table的意思，但是这道题显然没有LUT的精髓，不做也罢。</p>
<h4 id="5-2-4-More-Circuits"><a href="#5-2-4-More-Circuits" class="headerlink" title="5.2.4 More Circuits"></a>5.2.4 More Circuits</h4><h5 id="5-2-4-1-Rule-90"><a href="#5-2-4-1-Rule-90" class="headerlink" title="5.2.4.1 Rule 90"></a>5.2.4.1 Rule 90</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span>
    <span class="token keyword">input</span> clk<span class="token punctuation">,</span>
    <span class="token keyword">input</span> load<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">511</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> data<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">511</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> q <span class="token punctuation">)</span><span class="token punctuation">;</span> 

    
    <span class="token important">always @</span> <span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span>
        <span class="token keyword">begin</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>load<span class="token punctuation">)</span>
                q <span class="token operator">&lt;=</span> data<span class="token punctuation">;</span>
            <span class="token keyword">else</span>
                <span class="token keyword">begin</span>
                    q <span class="token operator">&lt;=</span> <span class="token operator">{</span><span class="token number">1'b0</span><span class="token punctuation">,</span> q<span class="token punctuation">[</span><span class="token number">511</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">}</span> <span class="token operator">^</span> <span class="token operator">{</span>q<span class="token punctuation">[</span><span class="token number">510</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">,</span><span class="token number">1'b0</span><span class="token operator">}</span><span class="token punctuation">;</span> 
                <span class="token keyword">end</span>
        <span class="token keyword">end</span>
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>后面的三道题都是元胞自动机，但是其实都是很普通的例子。</p>
<h5 id="5-2-4-2-Rule-110"><a href="#5-2-4-2-Rule-110" class="headerlink" title="5.2.4.2 Rule 110"></a>5.2.4.2 Rule 110</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span>
    <span class="token keyword">input</span> clk<span class="token punctuation">,</span>
    <span class="token keyword">input</span> load<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">511</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> data<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">511</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> q
<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token keyword">wire</span> <span class="token punctuation">[</span><span class="token number">511</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> q_left<span class="token punctuation">,</span> q_right<span class="token punctuation">;</span>
    <span class="token keyword">assign</span> q_left <span class="token operator">=</span> <span class="token operator">{</span><span class="token number">1'b0</span><span class="token punctuation">,</span>q<span class="token punctuation">[</span><span class="token number">511</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">}</span><span class="token punctuation">;</span>
    <span class="token keyword">assign</span> q_right <span class="token operator">=</span> <span class="token operator">{</span>q<span class="token punctuation">[</span><span class="token number">510</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">1'b0</span><span class="token operator">}</span><span class="token punctuation">;</span>
    
    
    <span class="token important">always@</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span>
        <span class="token function">if</span><span class="token punctuation">(</span>load<span class="token punctuation">)</span>
            q <span class="token operator">&lt;=</span> data<span class="token punctuation">;</span>
    <span class="token keyword">else</span>  <span class="token keyword">begin</span>
        q <span class="token operator">&lt;=</span> <span class="token punctuation">(</span>q <span class="token operator">&amp;</span> <span class="token operator">~</span>q_right<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token operator">~</span>q_left <span class="token operator">&amp;</span> q_right<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token operator">~</span>q <span class="token operator">&amp;</span> q_right<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span>
        <span class="token keyword">end</span>
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="5-2-4-3-Conway‘s-Game-of-Life-16-16"><a href="#5-2-4-3-Conway‘s-Game-of-Life-16-16" class="headerlink" title="5.2.4.3 Conway‘s Game of Life 16*16"></a>5.2.4.3 Conway‘s Game of Life 16*16</h5><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span>
    <span class="token keyword">input</span> clk<span class="token punctuation">,</span>
    <span class="token keyword">input</span> load<span class="token punctuation">,</span>
    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">255</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> data<span class="token punctuation">,</span>
    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">255</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> q <span class="token punctuation">)</span><span class="token punctuation">;</span> 
    
    <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">323</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> data_padding<span class="token punctuation">;</span> <span class="token comment">//18*18</span>
    <span class="token keyword">wire</span> <span class="token punctuation">[</span><span class="token number">255</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> q_next<span class="token punctuation">;</span>
    <span class="token keyword">integer</span> i<span class="token punctuation">,</span>j<span class="token punctuation">,</span>neighbour_cnt<span class="token punctuation">;</span>
    <span class="token comment">//在这道题目中，可以看到整数是可以代替一些寄存器功能的</span>
    
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>
    <span class="token keyword">begin</span>
       	<span class="token comment">//补全</span>
    	data_padding<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">{</span>q<span class="token punctuation">[</span><span class="token number">240</span><span class="token punctuation">]</span><span class="token punctuation">,</span>q<span class="token punctuation">[</span><span class="token number">255</span><span class="token punctuation">:</span><span class="token number">240</span><span class="token punctuation">]</span><span class="token punctuation">,</span>q<span class="token punctuation">[</span><span class="token number">255</span><span class="token punctuation">]</span><span class="token operator">}</span><span class="token punctuation">;</span>
        data_padding<span class="token punctuation">[</span><span class="token number">323</span><span class="token punctuation">:</span><span class="token number">306</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">{</span>q<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>q<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>q<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token operator">}</span><span class="token punctuation">;</span>
        <span class="token function">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">17</span><span class="token punctuation">;</span>i<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>
        	data_padding<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">18</span> <span class="token operator">+</span><span class="token punctuation">:</span><span class="token number">18</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">{</span>q<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">,</span>q<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">16</span> <span class="token operator">+</span><span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">,</span>q<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">16</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">}</span><span class="token punctuation">;</span>                
        <span class="token keyword">end</span>
        <span class="token comment">//count and update</span>
        <span class="token function">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">16</span><span class="token punctuation">;</span>i<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>
        	<span class="token function">for</span><span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span><span class="token number">16</span><span class="token punctuation">;</span>j<span class="token operator">=</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>
            	neighbour_cnt <span class="token operator">=</span> data_padding<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">18</span><span class="token operator">+</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">+</span>data_padding<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">18</span><span class="token operator">+</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">+</span>data_padding<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">18</span><span class="token operator">+</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">+</span>data_padding<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">18</span><span class="token operator">+</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">+</span>data_padding<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">18</span><span class="token operator">+</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">+</span>data_padding<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">18</span><span class="token operator">+</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">+</span>data_padding<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">18</span><span class="token operator">+</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">+</span>data_padding<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">18</span><span class="token operator">+</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token function">if</span><span class="token punctuation">(</span>neighbour_cnt <span class="token operator">&lt;=</span> <span class="token number">1</span> <span class="token operator">|</span> neighbour_cnt <span class="token operator">&gt;=</span><span class="token number">4</span><span class="token punctuation">)</span>
                	q_next<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">16</span><span class="token operator">+</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>neighbour_cnt <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span>
                    q_next<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">16</span><span class="token operator">+</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
                <span class="token keyword">else</span>
                    q_next<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">16</span><span class="token operator">+</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> q<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">16</span><span class="token operator">+</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//not change</span>
            <span class="token keyword">end</span>             
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
    
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span>
    <span class="token keyword">begin</span>
   		<span class="token function">if</span><span class="token punctuation">(</span>load<span class="token punctuation">)</span>
            q <span class="token operator">&lt;=</span> data<span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            q <span class="token operator">&lt;=</span> q_next<span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这个题目值得很好的研究，里面涉及了运用for和整数描述行为，二维展成一位的操作。</p>
<h4 id="5-2-5-Finite-State-Machines"><a href="#5-2-5-Finite-State-Machines" class="headerlink" title="5.2.5 Finite State Machines"></a>5.2.5 Finite State Machines</h4><p>待补全，抱歉</p>
<h3 id="5-3-Building-Larger-Circuits"><a href="#5-3-Building-Larger-Circuits" class="headerlink" title="5.3 Building Larger Circuits"></a>5.3 Building Larger Circuits</h3><p>待补全，抱歉</p>
<hr>
<h2 id="六、Verification：Reading-Simulation"><a href="#六、Verification：Reading-Simulation" class="headerlink" title="六、Verification：Reading Simulation"></a>六、Verification：Reading Simulation</h2><p>待补全，抱歉</p>
<hr>
<h2 id="七、Verification：Writing-Testbenches"><a href="#七、Verification：Writing-Testbenches" class="headerlink" title="七、Verification：Writing Testbenches"></a>七、Verification：Writing Testbenches</h2><h3 id="7-1-clock"><a href="#7-1-clock" class="headerlink" title="7.1 clock"></a>7.1 clock</h3><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">reg</span> clk<span class="token punctuation">;</span>
    <span class="token keyword">initial</span> <span class="token keyword">begin</span>
    	clk <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    
    <span class="token important">always </span><span class="token number">#5</span> clk <span class="token operator">=</span> <span class="token operator">~</span>clk<span class="token punctuation">;</span>
    
    dut <span class="token function">uut</span><span class="token punctuation">(</span>clk<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>关于如何书写testbench，之前是写过一篇文章的，但是那篇文章提到的问题依然存在，就是写的不多，没有经过很多的考验，这里附上地址<a target="_blank" rel="noopener external nofollow noreferrer" href="http://cscore.buaa.edu.cn/#/discussion_area/151/posts">http://cscore.buaa.edu.cn/#/discussion_area/151/posts</a></p>
<h3 id="7-2-Testbench1"><a href="#7-2-Testbench1" class="headerlink" title="7.2 Testbench1"></a>7.2 Testbench1</h3><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span> <span class="token keyword">output</span> <span class="token keyword">reg</span> A<span class="token punctuation">,</span> <span class="token keyword">output</span> <span class="token keyword">reg</span> B <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//</span>

    <span class="token comment">// generate input patterns here</span>
    <span class="token keyword">initial</span> <span class="token keyword">begin</span>
        A <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        B <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token number">#10</span> A <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token number">#5</span> B <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token number">#5</span> A <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token number">#20</span> B <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span>

<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="7-3-AND-gate"><a href="#7-3-AND-gate" class="headerlink" title="7.3 AND gate"></a>7.3 AND gate</h3><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">wire</span> out<span class="token punctuation">;</span>
    <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> in<span class="token punctuation">;</span>
    
    andgate <span class="token function">uut</span><span class="token punctuation">(</span>in<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">initial</span> <span class="token keyword">begin</span>
        in <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token number">#10</span> in <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token number">#10</span> in <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token number">#10</span> in <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span>
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>有关联的输入引脚可以合在一起，一并赋值。</p>
<h3 id="7-4-Testbench2"><a href="#7-4-Testbench2" class="headerlink" title="7.4 Testbench2"></a>7.4 Testbench2</h3><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">reg</span> clk<span class="token punctuation">;</span>
    <span class="token keyword">reg</span> in<span class="token punctuation">;</span>
    <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> s<span class="token punctuation">;</span>
    <span class="token keyword">wire</span> out<span class="token punctuation">;</span>
    
    q7 <span class="token function">uut</span><span class="token punctuation">(</span>clk<span class="token punctuation">,</span> in<span class="token punctuation">,</span> s<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">initial</span> <span class="token keyword">begin</span>
        clk <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        in <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        s <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token number">#10</span> 
        s <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>
        <span class="token number">#10</span>
        in <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        s <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token number">#10</span>
        in <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        s <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>
        <span class="token number">#10</span>
        in <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        s <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token number">#30</span>
        in <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    
    <span class="token important">always </span><span class="token number">#5</span> clk <span class="token operator">=</span> <span class="token operator">~</span>clk<span class="token punctuation">;</span>
    
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这种写法我不太喜欢，如果让我再写一次的话，我会写两个initial块，分别对in和s进行控制。</p>
<h3 id="7-5-T-flip-flop"><a href="#7-5-T-flip-flop" class="headerlink" title="7.5 T flip-flop"></a>7.5 T flip-flop</h3><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> top_module <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">reg</span> clk<span class="token punctuation">;</span>
    <span class="token keyword">reg</span> reset<span class="token punctuation">;</span>
    <span class="token keyword">reg</span> t<span class="token punctuation">;</span>
    <span class="token keyword">wire</span> q<span class="token punctuation">;</span>
    
    tff <span class="token function">u1_tff</span><span class="token punctuation">(</span>
        <span class="token punctuation">.</span><span class="token function">clk</span><span class="token punctuation">(</span>clk<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span>reset<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">.</span><span class="token function">t</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">.</span><span class="token function">q</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">//clk</span>
    <span class="token keyword">initial</span> <span class="token keyword">begin</span>
        clk <span class="token operator">=</span> <span class="token number">1'b0</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    
    <span class="token important">always </span><span class="token keyword">begin</span>
        <span class="token number">#5</span>
        clk <span class="token operator">=</span> <span class="token operator">~</span>clk<span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    
    <span class="token comment">//reset</span>
    <span class="token keyword">initial</span> <span class="token keyword">begin</span>
        reset <span class="token operator">=</span> <span class="token number">1'b0</span><span class="token punctuation">;</span>
        <span class="token number">#3</span><span class="token punctuation">;</span>
        reset <span class="token operator">=</span> <span class="token number">1'b1</span><span class="token punctuation">;</span>
        <span class="token number">#10</span><span class="token punctuation">;</span>
        reset <span class="token operator">=</span> <span class="token number">1'b0</span><span class="token punctuation">;</span>   
    <span class="token keyword">end</span>
    
    <span class="token important">always@</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span><span class="token keyword">begin</span>
        <span class="token function">if</span><span class="token punctuation">(</span>reset<span class="token punctuation">)</span><span class="token keyword">begin</span>
            t <span class="token operator">&lt;=</span> <span class="token number">1'b0</span><span class="token punctuation">;</span>
        <span class="token keyword">end</span>
        <span class="token keyword">else</span> <span class="token keyword">begin</span>
            t <span class="token operator">&lt;=</span> <span class="token number">1'b1</span><span class="token punctuation">;</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
 
<span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h2 id="八、写在结尾的话"><a href="#八、写在结尾的话" class="headerlink" title="八、写在结尾的话"></a>八、写在结尾的话</h2><p>写完以后心里空落落的，大致过了一遍，写的这是啥呀，都想自己抽自己大嘴巴子。反正最后还是发出来了，大家看个乐呵就好了。</p>
<p>在此特别鸣谢：</p>
<ul>
<li>叶哥哥</li>
<li>刘哥哥</li>
<li>ghy</li>
</ul>
<p>还有我刷题的时候对面的姑娘</p>
<ul>
<li>粉黛</li>
<li>娃娃量</li>
<li>发带</li>
<li>熊猫眼</li>
<li>葡萄</li>
<li>飞猫</li>
<li>小鼻子</li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/" rel="tag"><i class="fa fa-tag"></i> 知识总结</a>
              <a href="/tags/S3%E8%AF%BE%E4%B8%8A/" rel="tag"><i class="fa fa-tag"></i> S3课上</a>
              <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90/" rel="tag"><i class="fa fa-tag"></i> 计算机组成</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/posts/59164957/" rel="prev" title="计算机组成-简单流水线">
      <i class="fa fa-chevron-left"></i> 计算机组成-简单流水线
    </a></div>
      <div class="post-nav-item">
    <a href="/posts/c2aedd96/" rel="next" title="计算机组成-verilog进阶">
      计算机组成-verilog进阶 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
<script src="https://utteranc.es/client.js"
        repo="Thysrael/blog-comment"
        issue-term="title"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2%E7%9A%84%E8%AF%9D"><span class="nav-text">一、写在前面的话</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E6%97%A0%E5%85%B3%E9%A2%98%E7%9B%AE"><span class="nav-text">二、无关题目</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-stop"><span class="nav-text">2.1 $stop</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E5%B1%82%E6%AC%A1%E5%91%BD%E5%90%8D"><span class="nav-text">2.2 层次命名</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81Getting-Started"><span class="nav-text">三、Getting Started</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-Getting-Started"><span class="nav-text">3.1 Getting Started</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-Output-Zero"><span class="nav-text">3.2 Output Zero</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E3%80%81Verilog-Language"><span class="nav-text">四、Verilog Language</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-Basic"><span class="nav-text">4.1 Basic</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-1-Simple-Wire"><span class="nav-text">4.1.1 Simple Wire</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-2-Four-Wire"><span class="nav-text">4.1.2 Four Wire</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-3-Inverter"><span class="nav-text">4.1.3 Inverter</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-4-AND-gate"><span class="nav-text">4.1.4 AND gate</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-5-NOR-gate"><span class="nav-text">4.1.5 NOR gate</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-6-XNOR-gate"><span class="nav-text">4.1.6 XNOR gate</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-7-Declaring-wires"><span class="nav-text">4.1.7 Declaring wires</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-8-7458-chip"><span class="nav-text">4.1.8 7458 chip</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-Vector"><span class="nav-text">4.2 Vector</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-1-Vectors"><span class="nav-text">4.2.1 Vectors</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-2-Vectors-in-more-detail"><span class="nav-text">4.2.2 Vectors in more detail</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-3-Vector-part-select"><span class="nav-text">4.2.3 Vector part select</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-4-Bitwise-operators"><span class="nav-text">4.2.4 Bitwise operators</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-5-Four-input-gates"><span class="nav-text">4.2.5 Four-input gates</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-6-Vector-concatenation-operator"><span class="nav-text">4.2.6 Vector concatenation operator</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-7-Vector-reversal-1"><span class="nav-text">4.2.7 Vector reversal 1</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-8-Replication-operator"><span class="nav-text">4.2.8 Replication operator</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-9-More-replication"><span class="nav-text">4.2.9 More replication</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-Modules%EF%BC%9AHierarchy"><span class="nav-text">4.3 Modules：Hierarchy</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-1-Modules"><span class="nav-text">4.3.1 Modules</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-2-Connecting-ports-by-position"><span class="nav-text">4.3.2 Connecting ports by position</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-3-Connecting-ports-by-name"><span class="nav-text">4.3.3 Connecting ports by name</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-4-Three-modules"><span class="nav-text">4.3.4 Three modules</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-5-Modules-and-vectors"><span class="nav-text">4.3.5 Modules and vectors</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-6-Adder1"><span class="nav-text">4.3.6 Adder1</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-7-Adder2"><span class="nav-text">4.3.7 Adder2</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-8-Carry-select-adder"><span class="nav-text">4.3.8 Carry-select adder</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-9-Adder-subtractor"><span class="nav-text">4.3.9 Adder-subtractor</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-Procedures"><span class="nav-text">4.4 Procedures</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-4-1-Always-blocks%EF%BC%88combinational%EF%BC%89"><span class="nav-text">4.4.1 Always blocks（combinational）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-4-2-Always-blocks%EF%BC%88clocked%EF%BC%89"><span class="nav-text">4.4.2 Always blocks（clocked）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-4-3-If-statement"><span class="nav-text">4.4.3 If statement</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-4-4-If-statement-latches"><span class="nav-text">4.4.4 If statement latches</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-4-5-Case-statement"><span class="nav-text">4.4.5 Case statement</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-4-6-Priority-encoder"><span class="nav-text">4.4.6 Priority encoder</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-4-7-Priority-encoder-with-casez"><span class="nav-text">4.4.7 Priority encoder with casez</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-5-More-Verilog-Features"><span class="nav-text">4.5 More Verilog Features</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-5-1-Conditional-ternary-operator"><span class="nav-text">4.5.1 Conditional ternary operator</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-5-2-Reduction-operators"><span class="nav-text">4.5.2 Reduction operators</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-5-3-Reduction%EF%BC%9AEven-wider-gates"><span class="nav-text">4.5.3 Reduction：Even wider gates</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-5-4-Combinational-for-loop%EF%BC%9AVector-reversal2"><span class="nav-text">4.5.4 Combinational for-loop：Vector reversal2</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-5-5-Combinational-for-loop%EF%BC%9A255-bit-population-count"><span class="nav-text">4.5.5 Combinational for-loop：255-bit population count</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-5-6-Generate-for-loop%EF%BC%9A100-bit-binary-adder2"><span class="nav-text">4.5.6 Generate for-loop：100-bit binary adder2</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-5-7-Generate-for-loop%EF%BC%9A100-digit-BCD-adder"><span class="nav-text">4.5.7 Generate for-loop：100-digit BCD adder</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%94%E3%80%81Circuit"><span class="nav-text">五、Circuit</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-Combinational-Logic"><span class="nav-text">5.1 Combinational Logic</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-1-Basic-Gates"><span class="nav-text">5.1.1 Basic Gates</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#5-1-1-1-Wire"><span class="nav-text">5.1.1.1 Wire</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-1-1-2-GND"><span class="nav-text">5.1.1.2 GND</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-1-1-2-NOR"><span class="nav-text">5.1.1.2 NOR</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-1-1-3-Another-gate"><span class="nav-text">5.1.1.3 Another gate</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-1-1-4-Two-gates"><span class="nav-text">5.1.1.4 Two gates</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-1-1-5-More-logic-gates"><span class="nav-text">5.1.1.5 More logic gates</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-1-1-6-7420-chip"><span class="nav-text">5.1.1.6 7420 chip</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-1-1-7-Truth-tables"><span class="nav-text">5.1.1.7 Truth tables</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-1-1-8-Two-bit-equality"><span class="nav-text">5.1.1.8 Two-bit equality</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-1-1-9-Simple-circuit-A"><span class="nav-text">5.1.1.9 Simple circuit A</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-1-1-10-Simple-circuit-B"><span class="nav-text">5.1.1.10 Simple circuit B</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-1-1-11-Combine-circuits-A-and-B"><span class="nav-text">5.1.1.11 Combine circuits A and B</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-1-1-12-Ring-or-virbrate"><span class="nav-text">5.1.1.12 Ring or virbrate</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-1-1-13-Thermostat"><span class="nav-text">5.1.1.13 Thermostat</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-1-1-14-3-bit-population-count"><span class="nav-text">5.1.1.14 3-bit population count</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-1-1-15-Gates-and-vectors"><span class="nav-text">5.1.1.15 Gates and vectors</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-1-1-16-even-longer-Vectors"><span class="nav-text">5.1.1.16 even longer Vectors</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-2-Multiplexers"><span class="nav-text">5.1.2 Multiplexers</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#5-1-2-1-2-to-1-multiplexer"><span class="nav-text">5.1.2.1 2-to-1 multiplexer</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-1-2-2-2-to-1-bus-multiplexer"><span class="nav-text">5.1.2.2 2-to-1 bus multiplexer</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-1-2-3-9-to-1-multiplexer"><span class="nav-text">5.1.2.3 9-to-1 multiplexer</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-1-2-4-256-to-1-multiplexer"><span class="nav-text">5.1.2.4 256-to-1 multiplexer</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-1-2-5-256-to-1-4-bit-multiplexer"><span class="nav-text">5.1.2.5 256-to-1 4-bit multiplexer</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-3-Arithmetic-Circuits"><span class="nav-text">5.1.3 Arithmetic Circuits</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#5-1-3-1-half-adder"><span class="nav-text">5.1.3.1 half-adder</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-1-3-2-Full-adder"><span class="nav-text">5.1.3.2 Full adder</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-1-3-3-3-bit-binary-adder"><span class="nav-text">5.1.3.3 3-bit binary adder</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-1-3-4-Adder"><span class="nav-text">5.1.3.4 Adder</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-1-3-5-Signed-addition-overflow"><span class="nav-text">5.1.3.5 Signed addition overflow</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-1-3-6-100-bit-binary-adder"><span class="nav-text">5.1.3.6 100-bit binary adder</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-1-3-7-4-digit-BCD-adder"><span class="nav-text">5.1.3.7 4-digit BCD adder</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-4-Karnaugh-Map-to-Circuit"><span class="nav-text">5.1.4 Karnaugh Map to Circuit</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#5-1-4-1-3-variable"><span class="nav-text">5.1.4.1 3-variable</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-1-4-2-4-variable"><span class="nav-text">5.1.4.2 4-variable</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-1-4-3-4-variable"><span class="nav-text">5.1.4.3 4-variable</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-1-4-4-4-variable"><span class="nav-text">5.1.4.4 4-variable</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-1-4-5-4-variable"><span class="nav-text">5.1.4.5 4-variable</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-1-4-6-Minimum-SOP-and-POS"><span class="nav-text">5.1.4.6 Minimum SOP and POS</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-1-4-7-Karnaugh-map"><span class="nav-text">5.1.4.7 Karnaugh map</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-1-4-8-Karnaugh-map"><span class="nav-text">5.1.4.8 Karnaugh map</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-1-4-9-K-map-implemented-with-a-multiplexer"><span class="nav-text">5.1.4.9 K-map implemented with a multiplexer</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-Sequential-Logic"><span class="nav-text">5.2 Sequential Logic</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-1-Latches-and-Flip-Flops"><span class="nav-text">5.2.1 Latches and Flip-Flops</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-1-1-D-Flip-Flop"><span class="nav-text">5.2.1.1 D Flip-Flop</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-1-2-D-Flip-Flops"><span class="nav-text">5.2.1.2 D Flip-Flops</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-1-3-DFF-with-reset"><span class="nav-text">5.2.1.3 DFF with reset</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-1-3-DFF-with-reset-value"><span class="nav-text">5.2.1.3 DFF with reset value</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-1-4-DFF-with-asynchronous-reset"><span class="nav-text">5.2.1.4 DFF with asynchronous reset</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-1-5-DFF-with-byte-enable"><span class="nav-text">5.2.1.5 DFF with byte enable</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-1-6-D-latch"><span class="nav-text">5.2.1.6 D-latch</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-1-7-DFF"><span class="nav-text">5.2.1.7 DFF</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-1-8-DFF"><span class="nav-text">5.2.1.8 DFF</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-1-9-DFF-gate"><span class="nav-text">5.2.1.9 DFF+gate</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-1-10-Mux-and-DFF"><span class="nav-text">5.2.1.10 Mux and DFF</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-1-11-Mux-and-DFF"><span class="nav-text">5.2.1.11 Mux and DFF</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-1-12-DFF-and-gates"><span class="nav-text">5.2.1.12 DFF and gates</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-1-13-Create-circuit-from-truth-table"><span class="nav-text">5.2.1.13 Create circuit from truth table</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-1-14-Detect-an-edge"><span class="nav-text">5.2.1.14 Detect an edge</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-1-15-Detect-both-edge"><span class="nav-text">5.2.1.15 Detect both edge</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-1-16-Edge-capture-regesiter"><span class="nav-text">5.2.1.16 Edge capture regesiter</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-1-17-Dual-edge-triggered-flip-flop"><span class="nav-text">5.2.1.17 Dual-edge triggered flip-flop</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-2-Counters"><span class="nav-text">5.2.2 Counters</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-2-1-Four-bit-binary-counter"><span class="nav-text">5.2.2.1 Four-bit binary counter</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-2-2-Decade-counter"><span class="nav-text">5.2.2.2 Decade counter</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-2-3-Decade-counter-again"><span class="nav-text">5.2.2.3 Decade counter again</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-2-4-Slow-decade-counter"><span class="nav-text">5.2.2.4 Slow decade counter</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-2-5-Counter-1-12"><span class="nav-text">5.2.2.5 Counter 1-12</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-2-6-Counter-1000"><span class="nav-text">5.2.2.6 Counter 1000</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-2-7-4-digit-decimal-counter"><span class="nav-text">5.2.2.7 4-digit decimal counter</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-2-8-12-hour-clock"><span class="nav-text">5.2.2.8 12-hour clock</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-3-Shifter-Register"><span class="nav-text">5.2.3 Shifter Register</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-3-1-4-bit-shift-register"><span class="nav-text">5.2.3.1 4-bit shift register</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-3-2-Left-right-rotator"><span class="nav-text">5.2.3.2 Left&#x2F;right rotator</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-3-3-Left-right-arithmetic-shift-by-1-or-8"><span class="nav-text">5.2.3.3 Left&#x2F;right arithmetic shift by 1 or 8</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-3-4-5-bitLFSR"><span class="nav-text">5.2.3.4 5-bitLFSR</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-3-5-3-bitLFSR"><span class="nav-text">5.2.3.5 3-bitLFSR</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-3-6-32-bitLFSR"><span class="nav-text">5.2.3.6 32-bitLFSR</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-3-7-shift-register"><span class="nav-text">5.2.3.7 shift register</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-3-8-shift-register"><span class="nav-text">5.2.3.8 shift register</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-input-LUT"><span class="nav-text">3-input LUT</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-4-More-Circuits"><span class="nav-text">5.2.4 More Circuits</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-4-1-Rule-90"><span class="nav-text">5.2.4.1 Rule 90</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-4-2-Rule-110"><span class="nav-text">5.2.4.2 Rule 110</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-4-3-Conway%E2%80%98s-Game-of-Life-16-16"><span class="nav-text">5.2.4.3 Conway‘s Game of Life 16*16</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-5-Finite-State-Machines"><span class="nav-text">5.2.5 Finite State Machines</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-Building-Larger-Circuits"><span class="nav-text">5.3 Building Larger Circuits</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AD%E3%80%81Verification%EF%BC%9AReading-Simulation"><span class="nav-text">六、Verification：Reading Simulation</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%83%E3%80%81Verification%EF%BC%9AWriting-Testbenches"><span class="nav-text">七、Verification：Writing Testbenches</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-1-clock"><span class="nav-text">7.1 clock</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-2-Testbench1"><span class="nav-text">7.2 Testbench1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-3-AND-gate"><span class="nav-text">7.3 AND gate</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-4-Testbench2"><span class="nav-text">7.4 Testbench2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-5-T-flip-flop"><span class="nav-text">7.5 T flip-flop</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AB%E3%80%81%E5%86%99%E5%9C%A8%E7%BB%93%E5%B0%BE%E7%9A%84%E8%AF%9D"><span class="nav-text">八、写在结尾的话</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Thysrael"
      src="/images/avatar2.png">
  <p class="site-author-name" itemprop="name">Thysrael</p>
  <div class="site-description" itemprop="description">Can you hear me ?</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">199</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">31</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">70</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="">
    <a target="_blank" class="social-link" href="/atom.xml" style="color: burlywood;">
      <span class="icon">
        <i class="fa fa-rss"></i>
      </span>
      <span class="label">RSS</span>
    </a>
  </div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/thysrael" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;thysrael" rel="noopener external nofollow noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:thysrael@163.com" title="E-Mail → mailto:thysrael@163.com" rel="noopener external nofollow noreferrer" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2021.12.18 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Thysrael</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="Symbols count total">1.3m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">20:20</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

</body>
</html>
